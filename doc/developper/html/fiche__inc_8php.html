<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>phpcompta: fiche_inc.php File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">include</a></div>
<h1>fiche_inc.php File Reference</h1>Function for managing card, redundant with the class fiche. <a href="#_details">More...</a>
<p>

<p>
<a href="fiche__inc_8php-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a0">AddFiche</a> ($p_cn, $p_type, $p_array)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">ajoute une nouvelle fiche  <a href="#a0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a1">EncodeFiche</a> ($p_cn, $p_type, $p_array=null)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Affiche les détails d'une fiche et propose de mettre à jour ou si array est a null, permet d'ajouter une fiche, to fill the attribute.  <a href="#a1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a2">GetBaseFiche</a> ($p_cn, $p_type)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">donne la classe comptable de base d'une fiche  <a href="#a2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a3">GetBaseFicheDefault</a> ($p_cn, $p_type)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Give the default accounts of <a class="el" href="classfiche__def.html">fiche_def</a>.  <a href="#a3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a4">ViewFiche</a> ($p_cn, $p_type)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Montre les fiches d'une rubrique.  <a href="#a4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a5">GetNextFiche</a> ($p_cn, $p_base)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Crée le poste suivant pour une fiche en fonction de la classe de base (fichedef(fd_class_base)).  <a href="#a5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a6">ViewFicheDetail</a> ($p_cn, $p_id)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Montre le detail d'une fiche et ajoute les lignes manquantes dans le cas où le modèle à changer.  <a href="#a6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a7">UpdateFiche</a> ($p_cn, $p_array)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Met a jour une fiche change dans le plan comptable, fiche,et isupp.  <a href="#a7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a8">EncodeModele</a> ($p_js)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">parm :<ul>
<li>gen :</li><li>return:</li><li></li></ul>
 <a href="#a8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a9">DefModele</a> ($p_cn, $p_js, $p_array=null, $p_ligne=1)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Creation of a model of card or correction.  <a href="#a9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a10">AddModele</a> ($p_cn, $p_array)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a modele of card into the database.  <a href="#a10"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a11">UpdateModele</a> ($p_cn, $p_fiche)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Modify the model of card change some attribute (fd_label) and permit to add line.  <a href="#a11"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a12">GetDataModele</a> ($p_cn, $p_fiche)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the info of an fiche identified by p_fiche.  <a href="#a12"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a13">Remove</a> ($p_cn, $p_fid)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">enleve une fiche dans attr_value, jnt_fic_att_value et fiche a la condition que ce poste n'aie jamais été utilisé parm :<ul>
<li>p_cn</li></ul>
<p>
p_fid fiche(f_id) gen :<ul>
<li>none return:</li></ul>
<p>
none  <a href="#a13"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a14">getFicheName</a> ($p_cn, $p_id)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">retourne le nom de la fiche en fournissant le quick_code  <a href="#a14"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a15">getFicheNameById</a> ($p_cn, $p_id)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">retourne le nom de la fiche en fournissant le f_id  <a href="#a15"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a16">getFicheDefName</a> ($p_cn, $p_id)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">retourne le nom de la cat. de fiches  <a href="#a16"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a17">GetFicheJrn</a> ($p_cn, $p_jrn, $p_type)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get all the fiche related to a "journal".  <a href="#a17"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a18">Get_fiche_def_ref</a> ($p_cn)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">return an array containing all the data contained in the table <a class="el" href="classfiche__def__ref.html">fiche_def_ref</a> parm :<ul>
<li>$p_cn connection to the database gen :</li><li>none return: array if ok null otherwize </li></ul>
 <a href="#a18"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a19">Get_attr_min</a> ($p_cn, $p_fiche_def_ref)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">retrieve the mandatory field of the card model  <a href="#a19"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a20">Get_attr_def</a> ($p_cn, $p_fiche_def)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">retrieve the fields of the card model  <a href="#a20"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a21">GetCreateAccount</a> ($p_cn, $p_fiche_def)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">retrieve the fields of the card model which indicate if each cards needs its own account parm :<ul>
<li>$p_cn database connexion</li></ul>
<p>
$p_fiche_def_ref fiche_def.fd_id gen :<ul>
<li>return: not null if yes, each cards has its own account </li></ul>
 <a href="#a21"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a22">GetFicheDefRef</a> ($p_cn, $p_f_id)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">retrieve the <a class="el" href="fiche__def_8inc_8php.html#a1">fiche_def.frd_id</a> thanks the f_id of a card  <a href="#a22"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a23">GetFicheDef</a> ($p_cn, $p_f_id)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">retrieve the fiche_def.fd_id thanks the f_id of a card  <a href="#a23"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a24">GetClass</a> ($p_cn, $p_fid)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieve the account of a card.  <a href="#a24"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a25">InsertModeleLine</a> ($p_cn, $p_fid, $p_adid)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Insert a new row into jnt_fic_attr for adding a new attribute to the card model parm :<ul>
<li>p_cn connection</li></ul>
<p>
the fiche_def.fd_id, id of the cat of the model<ul>
<li>the ad_id is the attr_def.ad_id gen :<ul>
<li>none return: none. </li></ul>
</li></ul>
 <a href="#a25"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a26">SaveModeleName</a> ($p_cn, $p_fid, $p_label)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update the model's name.  <a href="#a26"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a27">DisplayDetailModele</a> ($p_cn, $p_array, $MaxLine)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Show the data contained in an array of a model of card (<a class="el" href="classfiche__def.html">fiche_def</a>).  <a href="#a27"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a28">GetParent</a> ($p_cn, $p_val)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the parent in tmp_pcmn.  <a href="#a28"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a29">getFicheAttribut</a> ($p_cn, $p_id, $p_attr=&quot;&quot;)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">retrun array of attribut or string  <a href="#a29"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fiche__inc_8php.html#a30">IsFicheOfJrn</a> ($p_cn, $p_jrn, $p_fiche, $p_type=&quot;&quot;)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if a fiche is used by a jrn return 1 if the fiche is in the range otherwise 0.  <a href="#a30"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Function for managing card, redundant with the class fiche. 
<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000013">Todo:</a></b></dt><dd>remove this file but adapt first the pages which needs those function and complete the <a class="el" href="class__fiche_8php.html">class_fiche.php</a> </dd></dl>

<p>
Definition in file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.<hr><h2>Function Documentation</h2>
<a class="anchor" name="a0"></a><!-- doxytag: member="fiche_inc.php::AddFiche" ref="a0" args="($p_cn, $p_type, $p_array)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">AddFiche           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_type</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_array</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
ajoute une nouvelle fiche 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$p_cn</em>&nbsp;</td><td>connexion </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$p_type</em>&nbsp;</td><td>type de la fiche </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$p_array</em>&nbsp;</td><td>tableau</td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l00038">38</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="setup_8php-source.html#l00269">$flag</a>, <a class="el" href="jrn__add_8php-source.html#l00172">$num</a>, <a class="el" href="line__update_8php-source.html#l00057">$p_parent</a>, <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="bank_8inc_8php-source.html#l00169">$sql</a>, <a class="el" href="eub__be_8inc_8php-source.html#l00055">$Sql</a>, <a class="el" href="postgres_8php-source.html#l00222">CountSql()</a>, <a class="el" href="debug_8php-source.html#l00034">echo_debug()</a>, <a class="el" href="ac__common_8php-source.html#l00036">echo_error()</a>, <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>, <a class="el" href="balance_8php-source.html#l00036">exit</a>, <a class="el" href="ac__common_8php-source.html#l00206">FormatString()</a>, <a class="el" href="fiche__inc_8php-source.html#l01199">Get_attr_def()</a>, <a class="el" href="fiche__inc_8php-source.html#l00370">GetBaseFiche()</a>, <a class="el" href="fiche__inc_8php-source.html#l01232">GetCreateAccount()</a>, <a class="el" href="fiche__inc_8php-source.html#l00480">GetNextFiche()</a>, <a class="el" href="postgres_8php-source.html#l00242">GetSequence()</a>, and <a class="el" href="ac__common_8php-source.html#l00076">isNumber()</a>.<div class="fragment"><pre class="fragment"><a name="l00038"></a>00038                                           {
<a name="l00039"></a>00039   <span class="comment">// TODO ADD ROLLBACK !!!</span>
<a name="l00040"></a>00040   <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">" AddFiche($p_cn,$p_type,$p_array) "</span>);
<a name="l00041"></a>00041   <span class="comment">// Push the array in element starting with p</span>
<a name="l00042"></a>00042   <span class="comment">//</span>
<a name="l00043"></a>00043   foreach ($p_array as $key=&gt;$element){
<a name="l00044"></a>00044     ${<span class="stringliteral">"p_$key"</span>}=$element;
<a name="l00045"></a>00045     <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"p_$key=$element;"</span>);
<a name="l00046"></a>00046   }
<a name="l00047"></a>00047   <span class="comment">// First verify that the name is not null</span>
<a name="l00048"></a>00048   <span class="comment">// av_text.ATTR_DEF_NAME</span>
<a name="l00049"></a>00049   <span class="keywordflow">if</span> ( strlen(trim($p_av_text0 )) ==0 )
<a name="l00050"></a>00050     <span class="keywordflow">return</span>;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   <span class="comment">// First Get the attr of the fiche</span>
<a name="l00053"></a>00053   $field=<a class="code" href="fiche__inc_8php.html#a20">Get_attr_def</a>($p_cn,$p_fd_id);
<a name="l00054"></a>00054 
<a name="l00055"></a>00055   <a class="code" href="setup_8php.html#a4">$flag</a>=1;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057   <span class="comment">// Create the Fiche</span>
<a name="l00058"></a>00058   <a class="code" href="eub__be_8inc_8php.html#a4">$Sql</a>=<span class="stringliteral">"insert into fiche (fd_id) values ("</span>.$p_fd_id.<span class="stringliteral">")"</span>;
<a name="l00059"></a>00059   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$Sql);
<a name="l00060"></a>00060 
<a name="l00061"></a>00061   <span class="comment">// Get is f_id (sequence)</span>
<a name="l00062"></a>00062   $l_f_id=<a class="code" href="postgres_8php.html#a12">GetSequence</a>($p_cn,'s_fiche');
<a name="l00063"></a>00063 
<a name="l00064"></a>00064   <span class="comment">// Should we Create accounts for each cards</span>
<a name="l00065"></a>00065   $create=<a class="code" href="fiche__inc_8php.html#a21">GetCreateAccount</a>($p_cn,$p_fd_id);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 
<a name="l00068"></a>00068   <span class="comment">// Is a account given ?</span>
<a name="l00069"></a>00069   <span class="keywordflow">for</span> ( $i = 0; $i &lt; $p_inc;$i++) {
<a name="l00070"></a>00070     <span class="comment">//Except for the class base</span>
<a name="l00071"></a>00071     <span class="keywordflow">if</span> ( ${<span class="stringliteral">"p_ad_id$i"</span>} == <a class="code" href="constant_8php.html#a55">ATTR_DEF_ACCOUNT</a> ) {
<a name="l00072"></a>00072       <span class="keywordflow">if</span> (strlen (trim(${<span class="stringliteral">"p_av_text$i"</span>})) == 0 or
<a name="l00073"></a>00073           <a class="code" href="ac__common_8php.html#a2">isNumber</a>(${<span class="stringliteral">"p_av_text$i"</span>}) == 0 )
<a name="l00074"></a>00074         {
<a name="l00075"></a>00075           <span class="keywordflow">break</span>;
<a name="l00076"></a>00076         }
<a name="l00077"></a>00077       <span class="comment">// if account already exist do nothing in tmp_pcmn otherwise add it</span>
<a name="l00078"></a>00078       <span class="keywordflow">if</span> (<a class="code" href="postgres_8php.html#a10">CountSql</a>($p_cn,<span class="stringliteral">"select pcm_val from tmp_pcmn where pcm_val="</span>.${<span class="stringliteral">"p_av_text$i"</span>}) == 0 )
<a name="l00079"></a>00079         {
<a name="l00080"></a>00080           $len=strlen(${<span class="stringliteral">"p_av_text$i"</span>})-1;
<a name="l00081"></a>00081           <span class="comment">// Mother account</span>
<a name="l00082"></a>00082           <a class="code" href="line__update_8php.html#a6">$p_parent</a>=substr(${<span class="stringliteral">"p_av_text$i"</span>},0,$len);
<a name="l00083"></a>00083           <span class="keywordflow">while</span> (<a class="code" href="postgres_8php.html#a10">CountSql</a>($p_cn,<span class="stringliteral">"select pcm_val from tmp_pcmn where pcm_val=$p_parent"</span>) == 0 and
<a name="l00084"></a>00084                  $len &gt; 0 ) {
<a name="l00085"></a>00085             $len--;
<a name="l00086"></a>00086             <a class="code" href="line__update_8php.html#a6">$p_parent</a>=substr(${<span class="stringliteral">"p_av_text$i"</span>},0,$len);
<a name="l00087"></a>00087           }
<a name="l00088"></a>00088           <span class="comment">// If no parent found</span>
<a name="l00089"></a>00089           <span class="keywordflow">if</span> ( $len &lt;= 0 ) {
<a name="l00090"></a>00090             <a class="code" href="ac__common_8php.html#a0">echo_error</a> (<span class="stringliteral">"No parent found"</span>);
<a name="l00091"></a>00091             <a class="code" href="balance_8php.html#a0">exit</a>(<span class="stringliteral">"No parent found for "</span>.${<span class="stringliteral">"p_av_text$i"</span>});
<a name="l00092"></a>00092 
<a name="l00093"></a>00093           } <span class="comment">// if $len == 0</span>
<a name="l00094"></a>00094           $lib=<a class="code" href="ac__common_8php.html#a9">FormatString</a>($p_av_text0);
<a name="l00095"></a>00095           <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=sprintf(<span class="stringliteral">"insert into tmp_pcmn (pcm_val,pcm_lib,pcm_val_parent) </span>
<a name="l00096"></a>00096 <span class="stringliteral">                values (%s,'%s',%d)"</span>,
<a name="l00097"></a>00097                        ${<span class="stringliteral">"p_av_text$i"</span>},
<a name="l00098"></a>00098                        $lib,
<a name="l00099"></a>00099                        $p_parent);
<a name="l00100"></a>00100 
<a name="l00101"></a>00101           <span class="comment">// Add if into tmp_pcmn</span>
<a name="l00102"></a>00102           <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$Sql);
<a name="l00103"></a>00103         }
<a name="l00104"></a>00104       <span class="comment">// Add it the jnt table</span>
<a name="l00105"></a>00105       <span class="comment">// 5 is always for the account post</span>
<a name="l00106"></a>00106       <a class="code" href="eub__be_8inc_8php.html#a4">$Sql</a>=sprintf(<span class="stringliteral">"insert into jnt_fic_att_value (f_id,ad_id) values (%d,%d)"</span>,
<a name="l00107"></a>00107                    $l_f_id,<a class="code" href="constant_8php.html#a55">ATTR_DEF_ACCOUNT</a>);
<a name="l00108"></a>00108       <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$Sql);
<a name="l00109"></a>00109       
<a name="l00110"></a>00110       <span class="comment">// Get the jft_id sequence (s_jnt_fic_att_value)</span>
<a name="l00111"></a>00111       $l_jft_id=<a class="code" href="postgres_8php.html#a12">GetSequence</a>($p_cn,'s_jnt_fic_att_value');
<a name="l00112"></a>00112       
<a name="l00113"></a>00113       
<a name="l00114"></a>00114       <span class="comment">// Add it the attr_value table</span>
<a name="l00115"></a>00115       <a class="code" href="eub__be_8inc_8php.html#a4">$Sql</a>=sprintf(<span class="stringliteral">"insert into attr_value(jft_id,av_text) values (%d,'%s')"</span>,
<a name="l00116"></a>00116                    $l_jft_id,${<span class="stringliteral">"p_av_text$i"</span>});
<a name="l00117"></a>00117       <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$Sql);
<a name="l00118"></a>00118       <span class="comment">// If create == 0 we don't create automatically an account</span>
<a name="l00119"></a>00119       $create=0;      
<a name="l00120"></a>00120     }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122   } <span class="comment">// for $i...</span>
<a name="l00123"></a>00123 
<a name="l00124"></a>00124   <a class="code" href="debug_8php.html#a0">echo_debug</a> ( <span class="stringliteral">" create = $create "</span>);
<a name="l00125"></a>00125   <span class="keywordflow">if</span> ( $create == 1 ) {
<a name="l00126"></a>00126     <span class="comment">// We create an account for each</span>
<a name="l00127"></a>00127     <span class="comment">// Get The Class Base</span>
<a name="l00128"></a>00128     $base=<a class="code" href="fiche__inc_8php.html#a2">GetBaseFiche</a>($p_cn,$p_type);
<a name="l00129"></a>00129     
<a name="l00130"></a>00130     <span class="comment">// If a specific post account is needed created it</span>
<a name="l00131"></a>00131     
<a name="l00132"></a>00132     <span class="keywordflow">if</span> ( $base !=null  ) {
<a name="l00133"></a>00133       <span class="comment">// if the class base is not null, create it in the tmp_pcmn</span>
<a name="l00134"></a>00134       <a class="code" href="jrn__add_8php.html#a17">$num</a>=<a class="code" href="fiche__inc_8php.html#a5">GetNextFiche</a>($p_cn,$base);
<a name="l00135"></a>00135 
<a name="l00136"></a>00136       $lib=<a class="code" href="ac__common_8php.html#a9">FormatString</a>($p_av_text0);
<a name="l00137"></a>00137       <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=sprintf(<span class="stringliteral">"insert into tmp_pcmn (pcm_val,pcm_lib,pcm_val_parent) </span>
<a name="l00138"></a>00138 <span class="stringliteral">                values (%s,'%s',%d)"</span>,
<a name="l00139"></a>00139                    $num,
<a name="l00140"></a>00140                    $lib,
<a name="l00141"></a>00141                    $base);
<a name="l00142"></a>00142       <a class="code" href="debug_8php.html#a0">echo_debug</a>($sql);
<a name="l00143"></a>00143       <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l00144"></a>00144       <span class="comment">// Add it the jnt table</span>
<a name="l00145"></a>00145       <span class="comment">// 5 is always for the account post</span>
<a name="l00146"></a>00146       <a class="code" href="eub__be_8inc_8php.html#a4">$Sql</a>=sprintf(<span class="stringliteral">"insert into jnt_fic_att_value (f_id,ad_id) values (%d,%d)"</span>,
<a name="l00147"></a>00147                    $l_f_id,<a class="code" href="constant_8php.html#a55">ATTR_DEF_ACCOUNT</a>);
<a name="l00148"></a>00148       <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$Sql);
<a name="l00149"></a>00149       
<a name="l00150"></a>00150       <span class="comment">// Get the jft_id sequence (s_jnt_fic_att_value)</span>
<a name="l00151"></a>00151       $l_jft_id=<a class="code" href="postgres_8php.html#a12">GetSequence</a>($p_cn,'s_jnt_fic_att_value');
<a name="l00152"></a>00152       
<a name="l00153"></a>00153       
<a name="l00154"></a>00154       <span class="comment">// Add it the attr_value table</span>
<a name="l00155"></a>00155       <a class="code" href="eub__be_8inc_8php.html#a4">$Sql</a>=sprintf(<span class="stringliteral">"insert into attr_value(jft_id,av_text) values (%d,'%s')"</span>,
<a name="l00156"></a>00156                    $l_jft_id,$num);
<a name="l00157"></a>00157       <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$Sql);
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159   }<span class="comment">// end create accounts for each cards</span>
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 
<a name="l00162"></a>00162   <span class="comment">// Add the others attribut in jnt_fic_att_value and after in attr_value</span>
<a name="l00163"></a>00163   <span class="keywordflow">for</span> ( $i = 0; $i &lt; $p_inc;$i++) {
<a name="l00164"></a>00164     <span class="comment">//Except for the class base</span>
<a name="l00165"></a>00165        <span class="keywordflow">if</span> ( ${<span class="stringliteral">"p_ad_id$i"</span>} == <a class="code" href="constant_8php.html#a55">ATTR_DEF_ACCOUNT</a> ) <span class="keywordflow">continue</span>;
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     <span class="comment">// Special treatment for QuickCode</span>
<a name="l00168"></a>00168        <span class="keywordflow">if</span> ( ${<span class="stringliteral">"p_ad_id$i"</span>} == <a class="code" href="constant_8php.html#a78">ATTR_DEF_QUICKCODE</a> ) {
<a name="l00169"></a>00169          <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=sprintf(<span class="stringliteral">"select insert_quick_code(%d,'%s')"</span>,
<a name="l00170"></a>00170                       $l_f_id,<a class="code" href="ac__common_8php.html#a9">FormatString</a>(${<span class="stringliteral">"p_av_text$i"</span>}));
<a name="l00171"></a>00171          <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l00172"></a>00172          <span class="keywordflow">continue</span>;
<a name="l00173"></a>00173        }
<a name="l00174"></a>00174     <span class="comment">// Add it the jnt table</span>
<a name="l00175"></a>00175     <a class="code" href="eub__be_8inc_8php.html#a4">$Sql</a>=sprintf(<span class="stringliteral">"insert into jnt_fic_att_value (f_id,ad_id) values (%d,%d)"</span>,
<a name="l00176"></a>00176                  $l_f_id,${<span class="stringliteral">"p_ad_id$i"</span>});
<a name="l00177"></a>00177     <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$Sql);
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     <span class="comment">// Get the jft_id sequence (s_jnt_fic_att_value)</span>
<a name="l00180"></a>00180     $l_jft_id=<a class="code" href="postgres_8php.html#a12">GetSequence</a>($p_cn,'s_jnt_fic_att_value');
<a name="l00181"></a>00181 
<a name="l00182"></a>00182     <span class="comment">// test the vat rate</span>
<a name="l00183"></a>00183     <span class="keywordflow">if</span> (  ${<span class="stringliteral">"p_ad_id$i"</span>} == <a class="code" href="constant_8php.html#a59">ATTR_DEF_TVA</a> ) {
<a name="l00184"></a>00184       <span class="comment">// is a rate given </span>
<a name="l00185"></a>00185       <span class="keywordflow">if</span> ( strlen(trim(${<span class="stringliteral">"p_av_text$i"</span>})) != 0 and 
<a name="l00186"></a>00186            <a class="code" href="ac__common_8php.html#a2">isNumber</a>(${<span class="stringliteral">"p_av_text$i"</span>}) == 1) {
<a name="l00187"></a>00187         <span class="comment">// is a valid rate ?</span>
<a name="l00188"></a>00188         <span class="keywordflow">if</span> ( <a class="code" href="postgres_8php.html#a10">CountSql</a>($p_cn,<span class="stringliteral">"select * from tva_rate where tva_id='"</span>.${<span class="stringliteral">"p_av_text$i"</span>}.<span class="stringliteral">"'"</span>) == 0 ) {
<a name="l00189"></a>00189           <span class="comment">// the rate doesn't exist</span>
<a name="l00190"></a>00190           ${<span class="stringliteral">"p_av_text$i"</span>}=1;
<a name="l00191"></a>00191           <span class="comment">// warning</span>
<a name="l00192"></a>00192           <a class="code" href="ac__common_8php.html#a0">echo_error</a>('invalid rate') ;
<a name="l00193"></a>00193           echo '&lt;script&gt;
<a name="l00194"></a>00194                 alert(<span class="stringliteral">"Attention tva invalid, valeur par défaut =1 "</span>);
<a name="l00195"></a>00195               &lt;/script&gt;';
<a name="l00196"></a>00196           
<a name="l00197"></a>00197         }
<a name="l00198"></a>00198       }<span class="comment">// if a rate is given</span>
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200     $text=<a class="code" href="ac__common_8php.html#a9">FormatString</a>(${<span class="stringliteral">"p_av_text$i"</span>});
<a name="l00201"></a>00201     <span class="comment">// Add it the attr_value table</span>
<a name="l00202"></a>00202     <a class="code" href="eub__be_8inc_8php.html#a4">$Sql</a>=sprintf(<span class="stringliteral">"insert into attr_value(jft_id,av_text) values (%d,'%s')"</span>,
<a name="l00203"></a>00203                  $l_jft_id,$text);
<a name="l00204"></a>00204     <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$Sql);
<a name="l00205"></a>00205 
<a name="l00206"></a>00206   }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a10"></a><!-- doxytag: member="fiche_inc.php::AddModele" ref="a10" args="($p_cn, $p_array)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">AddModele           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_array</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Add a modele of card into the database. 
<p>
AddModele<p>
parm :<ul>
<li>connection</li></ul>
<p>
array gen :<ul>
<li>none table : insert into <a class="el" href="classfiche__def.html">fiche_def</a> insert into attr_def return:</li><li>none</li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l00779">779</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="bank_8inc_8php-source.html#l00169">$sql</a>, <a class="el" href="debug_8php-source.html#l00034">echo_debug()</a>, <a class="el" href="ac__common_8php-source.html#l00036">echo_error()</a>, <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>, <a class="el" href="ac__common_8php-source.html#l00206">FormatString()</a>, <a class="el" href="fiche__inc_8php-source.html#l01167">Get_attr_min()</a>, <a class="el" href="fiche__inc_8php-source.html#l00392">GetBaseFicheDefault()</a>, <a class="el" href="postgres_8php-source.html#l00242">GetSequence()</a>, and <a class="el" href="ac__common_8php-source.html#l00076">isNumber()</a>.<div class="fragment"><pre class="fragment"><a name="l00779"></a>00779                                    {
<a name="l00780"></a>00780   <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"AddModele"</span>);
<a name="l00781"></a>00781   <span class="comment">// Show what we receive for debug purpose only</span>
<a name="l00782"></a>00782   <span class="comment">//</span>
<a name="l00783"></a>00783   foreach ( $p_array as $key=&gt;$element ) {
<a name="l00784"></a>00784     <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"p_$key $element"</span>);
<a name="l00785"></a>00785     ${<span class="stringliteral">"p_$key"</span>}=$element;
<a name="l00786"></a>00786   }
<a name="l00787"></a>00787   <span class="comment">// Format correctly the name of the cat. of card</span>
<a name="l00788"></a>00788   $p_nom_mod=<a class="code" href="ac__common_8php.html#a9">FormatString</a>($p_nom_mod);
<a name="l00789"></a>00789   <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"Adding $p_nom_mod"</span>);
<a name="l00790"></a>00790    <span class="comment">// Format the p_class_base </span>
<a name="l00791"></a>00791   <span class="comment">// must be an integer</span>
<a name="l00792"></a>00792   <span class="keywordflow">if</span> ( <a class="code" href="ac__common_8php.html#a2">isNumber</a>($p_class_base) == 0 &amp;&amp; <a class="code" href="ac__common_8php.html#a9">FormatString</a>($p_class_base) != null ) {
<a name="l00793"></a>00793     <a class="code" href="ac__common_8php.html#a0">echo_error</a> ('p_class_base is NOT a number');
<a name="l00794"></a>00794   }
<a name="l00795"></a>00795   <span class="keywordflow">if</span> ( strlen(trim($p_nom_mod)) == 0 ) 
<a name="l00796"></a>00796     <span class="keywordflow">return</span>;
<a name="l00797"></a>00797 
<a name="l00798"></a>00798   <span class="comment">// $p_FICHE_REF cannot be null !!! (== fiche_def_ref.frd_id</span>
<a name="l00799"></a>00799   <span class="keywordflow">if</span> (! isset ($p_FICHE_REF) or strlen($p_FICHE_REF) == 0 ) {
<a name="l00800"></a>00800     <a class="code" href="ac__common_8php.html#a0">echo_error</a> (<span class="stringliteral">"AddModele : fiche_ref MUST NOT be null or empty"</span>);
<a name="l00801"></a>00801     <span class="keywordflow">return</span>;
<a name="l00802"></a>00802   }
<a name="l00803"></a>00803   <span class="comment">// build the sql request for fiche_def</span>
<a name="l00804"></a>00804   <span class="comment">// and insert into fiche_def</span>
<a name="l00805"></a>00805   <span class="comment">// if p_class_base is null get the default class base from</span>
<a name="l00806"></a>00806   <span class="comment">// fiche_def_ref</span>
<a name="l00807"></a>00807   <span class="keywordflow">if</span> ( <a class="code" href="ac__common_8php.html#a9">FormatString</a>($p_class_base) == null )
<a name="l00808"></a>00808     { <span class="comment">// p_class is null</span>
<a name="l00809"></a>00809       <span class="comment">// So we take the default one</span>
<a name="l00810"></a>00810       $p_class_base=<a class="code" href="fiche__inc_8php.html#a3">GetBaseFicheDefault</a>($p_cn,$p_FICHE_REF);
<a name="l00811"></a>00811     }
<a name="l00812"></a>00812   <span class="comment">// Set the value of fiche_def.fd_create_account</span>
<a name="l00813"></a>00813   <span class="keywordflow">if</span> ( isset($p_create)) 
<a name="l00814"></a>00814     $p_create='<span class="keyword">true</span>';
<a name="l00815"></a>00815   <span class="keywordflow">else</span>
<a name="l00816"></a>00816     $p_create='<span class="keyword">false</span>';
<a name="l00817"></a>00817 
<a name="l00818"></a>00818   <span class="comment">// Class is valid ?</span>
<a name="l00819"></a>00819   <span class="keywordflow">if</span> ( <a class="code" href="ac__common_8php.html#a9">FormatString</a>($p_class_base) != null) {
<a name="l00820"></a>00820 
<a name="l00821"></a>00821     <span class="comment">// p_class is a valid number</span>
<a name="l00822"></a>00822     <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=sprintf(<span class="stringliteral">"insert into fiche_def(fd_label,fd_class_base,frd_id,fd_create_account) </span>
<a name="l00823"></a>00823 <span class="stringliteral">                values ('%s',%s,%d,'%s')"</span>,
<a name="l00824"></a>00824                  $p_nom_mod,$p_class_base,$p_FICHE_REF,$p_create);
<a name="l00825"></a>00825     <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l00826"></a>00826 
<a name="l00827"></a>00827     <span class="comment">// p_class must be added to tmp_pcmn </span>
<a name="l00828"></a>00828     <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=sprintf(<span class="stringliteral">"select account_add(%d,'%s')"</span>,
<a name="l00829"></a>00829                  $p_class_base,$p_nom_mod);
<a name="l00830"></a>00830 
<a name="l00831"></a>00831     <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l00832"></a>00832 
<a name="l00833"></a>00833     <span class="comment">// Get the fd_id</span>
<a name="l00834"></a>00834     $fd_id=<a class="code" href="postgres_8php.html#a12">GetSequence</a>($p_cn,'s_fdef');
<a name="l00835"></a>00835 
<a name="l00836"></a>00836     <span class="comment">// Add the class_base if needed</span>
<a name="l00837"></a>00837 
<a name="l00838"></a>00838     <span class="keywordflow">if</span> ( $p_create=='<span class="keyword">true</span>' ) {
<a name="l00839"></a>00839       <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=sprintf(<span class="stringliteral">"insert into jnt_fic_attr(fd_id,ad_id) </span>
<a name="l00840"></a>00840 <span class="stringliteral">                     values (%d,%d)"</span>,$fd_id,<a class="code" href="constant_8php.html#a55">ATTR_DEF_ACCOUNT</a>);
<a name="l00841"></a>00841       <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l00842"></a>00842     }
<a name="l00843"></a>00843   } <span class="keywordflow">else</span> {
<a name="l00844"></a>00844     <span class="comment">//There is no class base not even as default</span>
<a name="l00845"></a>00845     <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=sprintf(<span class="stringliteral">"insert into fiche_def(fd_label,frd_id,fd_create_account) values ('%s',%d,'%s')"</span>,
<a name="l00846"></a>00846                  $p_nom_mod,$p_FICHE_REF,$p_create);
<a name="l00847"></a>00847 
<a name="l00848"></a>00848   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l00849"></a>00849 
<a name="l00850"></a>00850   <span class="comment">// Get the fd_id</span>
<a name="l00851"></a>00851   $fd_id=<a class="code" href="postgres_8php.html#a12">GetSequence</a>($p_cn,'s_fdef');
<a name="l00852"></a>00852 
<a name="l00853"></a>00853   }
<a name="l00854"></a>00854 
<a name="l00855"></a>00855   <span class="comment">// Get the default attr_def from attr_min</span>
<a name="l00856"></a>00856   $def_attr=<a class="code" href="fiche__inc_8php.html#a19">Get_attr_min</a>($p_cn,$p_FICHE_REF);
<a name="l00857"></a>00857 
<a name="l00858"></a>00858    <span class="comment">//if defaut attr not null </span>
<a name="l00859"></a>00859   <span class="comment">// build the sql insert for the table attr_def</span>
<a name="l00860"></a>00860   <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>($def_attr) != 0 ) {
<a name="l00861"></a>00861     <span class="comment">// insert all the mandatory fields into jnt_fiche_attr</span>
<a name="l00862"></a>00862     foreach ( $def_attr as $i=&gt;$v) {
<a name="l00863"></a>00863       <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=sprintf(<span class="stringliteral">"insert into jnt_fic_Attr(fd_id,ad_id)</span>
<a name="l00864"></a>00864 <span class="stringliteral">                   values (%d,%s)"</span>,
<a name="l00865"></a>00865                    $fd_id,$v['ad_id']);
<a name="l00866"></a>00866       <a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l00867"></a>00867     }
<a name="l00868"></a>00868   }
<a name="l00869"></a>00869   
<a name="l00870"></a>00870   
<a name="l00871"></a>00871 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a9"></a><!-- doxytag: member="fiche_inc.php::DefModele" ref="a9" args="($p_cn, $p_js, $p_array=null, $p_ligne=1)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">DefModele           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_js</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_array</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_ligne</em> = <code>1</code></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Creation of a model of card or correction. 
<p>
DefModele<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$p_cn</em>&nbsp;</td><td>database connection </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$p_ligne</em>&nbsp;</td><td>number of lines </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$p_array</em>&nbsp;</td><td>array </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$p_js</em>&nbsp;</td><td>class base (javascript code)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>nothing</dd></dl>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l00707">707</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="fortis__be_8inc_8php-source.html#l00054">$check</a>, <a class="el" href="debug_8php-source.html#l00034">echo_debug()</a>, <a class="el" href="fiche__inc_8php-source.html#l01133">Get_fiche_def_ref()</a>, and <a class="el" href="pref_8inc_8php-source.html#l00048">METHOD</a>.<div class="fragment"><pre class="fragment"><a name="l00708"></a>00708 {
<a name="l00709"></a>00709   <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"DefModele ($p_array,$p_ligne=1) "</span>);
<a name="l00710"></a>00710 
<a name="l00711"></a>00711   <span class="comment">// Creating form</span>
<a name="l00712"></a>00712   $display='&lt;<a class="code" href="constant_8php.html#a7">FORM</a> <a class="code" href="constant_8php.html#a44">ACTION</a>=<span class="stringliteral">"fiche.php"</span> <a class="code" href="pref_8inc_8php.html#a0">METHOD</a>=<span class="stringliteral">"POST"</span>&gt;';
<a name="l00713"></a>00713 
<a name="l00714"></a>00714   <span class="comment">// Number of line of the card</span>
<a name="l00715"></a>00715   $display.='&lt;INPUT TYPE=<span class="stringliteral">"HIDDEN"</span> NAME=<span class="stringliteral">"INC"</span> VALUE=<span class="stringliteral">"'.$p_ligne.'"</span>&gt;';
<a name="l00716"></a>00716 
<a name="l00717"></a>00717   <span class="comment">// Table of input</span>
<a name="l00718"></a>00718   $display.='&lt;TABLE BORDER=<span class="stringliteral">"0"</span> CELLSPACING=<span class="stringliteral">"0"</span>&gt;';
<a name="l00719"></a>00719   
<a name="l00720"></a>00720   
<a name="l00721"></a>00721   <span class="comment">//Name of the CARD (fiche_def.fd_label)</span>
<a name="l00722"></a>00722   $display.='&lt;TR&gt;&lt;TD&gt; Catégorie de <a class="code" href="classfiche.html">fiche</a> &lt;/TD&gt;';
<a name="l00723"></a>00723   $display.='&lt;TD&gt;&lt;INPUT TYPE=<span class="stringliteral">"INPUT"</span> NAME=<span class="stringliteral">"nom_mod"</span>&gt;';
<a name="l00724"></a>00724   $display.='&lt;/TD&gt;&lt;/TR&gt;';
<a name="l00725"></a>00725 
<a name="l00726"></a>00726   <span class="comment">// Class base fiche_def.fd_class_base (optional)</span>
<a name="l00727"></a>00727   $display.='&lt;TR&gt;&lt;TD&gt; Classe de base &lt;/TD&gt;';
<a name="l00728"></a>00728   $display.='&lt;TD&gt;&lt;INPUT TYPE=<span class="stringliteral">"INPUT"</span> NAME=<span class="stringliteral">"class_base"</span>&gt; '.$p_js;
<a name="l00729"></a>00729   $display.='&lt;/TD&gt;&lt;/TR&gt;';
<a name="l00730"></a>00730   <span class="comment">// Checkbox for the creation of a post</span>
<a name="l00731"></a>00731   $display.='&lt;TR&gt;&lt;TD&gt; &lt;INPUT TYPE=<span class="stringliteral">"CHECKBOX"</span> NAME=<span class="stringliteral">"create"</span> CHECKED&gt;Cr&amp;eacute;ation automatique du <a class="code" href="classposte.html">poste</a> comptable&lt;/TD&gt;&lt;/TR&gt;';
<a name="l00732"></a>00732 
<a name="l00733"></a>00733   <span class="comment">//display the different template</span>
<a name="l00734"></a>00734   $ref=<a class="code" href="fiche__inc_8php.html#a18">Get_fiche_def_ref</a>($p_cn);
<a name="l00735"></a>00735 
<a name="l00736"></a>00736   <span class="comment">// check if $ref is an array </span>
<a name="l00737"></a>00737   <span class="comment">// and display the choice</span>
<a name="l00738"></a>00738 
<a name="l00739"></a>00739   <span class="comment">// select by default the first choice</span>
<a name="l00740"></a>00740   <a class="code" href="fortis__be_8inc_8php.html#a2">$check</a>=<span class="stringliteral">"CHECKED"</span>;
<a name="l00741"></a>00741   <span class="keywordflow">if</span> ( <span class="keyword">sizeof</span>($ref)  ) {
<a name="l00742"></a>00742     foreach ($ref as $i=&gt;$v) {
<a name="l00743"></a>00743       $display.='&lt;TR&gt;&lt;TD COLSPAN=<span class="stringliteral">"2"</span>&gt;';
<a name="l00744"></a>00744 
<a name="l00745"></a>00745       $display.='&lt;INPUT TYPE=<span class="stringliteral">"RADIO"</span> NAME=<span class="stringliteral">"FICHE_REF"</span> VALUE=<span class="stringliteral">"'.$v['id'].'"</span>'.$check.<span class="charliteral">'&gt;'</span>;
<a name="l00746"></a>00746       $display.=$v['text'];
<a name="l00747"></a>00747       <span class="comment">// if a class base exist in fiche_def_ref, we display it</span>
<a name="l00748"></a>00748       <span class="keywordflow">if</span> ( <span class="keyword">sizeof</span> ($v['<span class="keyword">class</span>']) != 0 ) 
<a name="l00749"></a>00749            $display.=<span class="stringliteral">"&amp;nbsp;&amp;nbsp&lt;I&gt;Class base = "</span>.$v['<span class="keyword">class</span>'].<span class="stringliteral">"&lt;/I&gt;"</span>;
<a name="l00750"></a>00750       $display.=<span class="stringliteral">"&lt;/TD&gt;&lt;/TR&gt;"</span>;
<a name="l00751"></a>00751       <a class="code" href="fortis__be_8inc_8php.html#a2">$check</a>=<span class="stringliteral">""</span>;
<a name="l00752"></a>00752     }
<a name="l00753"></a>00753  
<a name="l00754"></a>00754   }
<a name="l00755"></a>00755   <span class="comment">// closing the form</span>
<a name="l00756"></a>00756   $display.='&lt;/TABLE&gt;';
<a name="l00757"></a>00757   $display.='&lt;INPUT TYPE=<span class="stringliteral">"SUBMIT"</span> NAME=<span class="stringliteral">"add_modele"</span> VALUE=<span class="stringliteral">"Sauve"</span>&gt;';
<a name="l00758"></a>00758   $display.='&lt;/<a class="code" href="constant_8php.html#a7">FORM</a>&gt;';
<a name="l00759"></a>00759 
<a name="l00760"></a>00760   <span class="comment">// display it</span>
<a name="l00761"></a>00761   echo $display;
<a name="l00762"></a>00762 
<a name="l00763"></a>00763 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a27"></a><!-- doxytag: member="fiche_inc.php::DisplayDetailModele" ref="a27" args="($p_cn, $p_array, $MaxLine)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">DisplayDetailModele           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_array</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>MaxLine</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Show the data contained in an array of a model of card (<a class="el" href="classfiche__def.html">fiche_def</a>). 
<p>
DisplayDetailModele<p>
parm :<ul>
<li>p_cn database connection<ul>
<li>array containing label,class_base,fd_id,ad_textX,ad_idX</li></ul>
</li><li>number of line gen :<ul>
<li>none return: none</li></ul>
</li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01408">1408</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="balance_8php-source.html#l00118">$i</a>, <a class="el" href="bank_8inc_8php-source.html#l00174">$l</a>, <a class="el" href="setup_8php-source.html#l00438">$M</a>, <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="debug_8php-source.html#l00034">echo_debug()</a>, <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>, <a class="el" href="balance_8php-source.html#l00076">label</a>, and <a class="el" href="action_8inc_8php-source.html#l00241">value</a>.
<p>
Referenced by <a class="el" href="fiche__inc_8php-source.html#l00887">UpdateModele()</a>.<div class="fragment"><pre class="fragment"><a name="l01409"></a>01409 {
<a name="l01410"></a>01410   <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"DisplayDetailModele"</span>);
<a name="l01411"></a>01411 
<a name="l01412"></a>01412   foreach ($p_array as $v=&gt;$i) { 
<a name="l01413"></a>01413     <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"v == $v i==$i"</span>);
<a name="l01414"></a>01414     ${<span class="stringliteral">"$v"</span>}=<a class="code" href="balance_8php.html#a12">$i</a>;
<a name="l01415"></a>01415   }
<a name="l01416"></a>01416   echo '&lt;<a class="code" href="constant_8php.html#a7">FORM</a> <a class="code" href="classaction.html">action</a>=<span class="stringliteral">"fiche.php"</span> method=<span class="stringliteral">"get"</span>&gt;';
<a name="l01417"></a>01417   echo '&lt;INPUT TYPE=<span class="stringliteral">"HIDDEN"</span> NAME=<span class="stringliteral">"fd_id"</span> VALUE=<span class="stringliteral">"'.$fd_id.'"</span>&gt;';
<a name="l01418"></a>01418 
<a name="l01419"></a>01419   printf(<span class="stringliteral">"&lt;TABLE&gt;"</span>);
<a name="l01420"></a>01420   <span class="comment">// Display each attribute</span>
<a name="l01421"></a>01421   <span class="keywordflow">for</span> ($i=0;$i&lt;$MaxLine;$i++) {
<a name="l01422"></a>01422     echo '&lt;TR&gt;&lt;td&gt;';
<a name="l01423"></a>01423     <span class="comment">// Can change the name</span>
<a name="l01424"></a>01424     <span class="keywordflow">if</span> ( ${<span class="stringliteral">"ad_id$i"</span>} == <a class="code" href="constant_8php.html#a56">ATTR_DEF_NAME</a> ) {
<a name="l01425"></a>01425       printf('Label&lt;/TD&gt;&lt;TD&gt;&lt;INPUT TYPE=<span class="stringliteral">"TEXT"</span> NAME=<span class="stringliteral">"label"</span> VALUE=<span class="stringliteral">"%s"</span>&gt;',
<a name="l01426"></a>01426              $<a class="code" href="balance_8php.html#a6">label</a>);
<a name="l01427"></a>01427       printf('&lt;/td&gt;&lt;TD&gt;&lt;input type=<span class="stringliteral">"submit"</span> NAME=<span class="stringliteral">"change_name"</span> <a class="code" href="action_8inc_8php.html#a19">value</a>=<span class="stringliteral">"Change Nom"</span>&gt;');
<a name="l01428"></a>01428     } <span class="keywordflow">else</span> {
<a name="l01429"></a>01429       <span class="comment">// The attr.</span>
<a name="l01430"></a>01430       printf('%s ',
<a name="l01431"></a>01431              ${<span class="stringliteral">"ad_text$i"</span>});
<a name="l01432"></a>01432     }
<a name="l01433"></a>01433     echo '&lt;/td&gt;&lt;/tr&gt;';
<a name="l01434"></a>01434   }
<a name="l01435"></a>01435 
<a name="l01436"></a>01436   <span class="comment">// Show the possible attribute which are not already attribute of the model</span>
<a name="l01437"></a>01437   <span class="comment">// of card</span>
<a name="l01438"></a>01438   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"select ad_id,ad_text from attr_def </span>
<a name="l01439"></a>01439 <span class="stringliteral">                       where ad_id not in (select ad_id from fiche_def natural join jnt_fic_attr</span>
<a name="l01440"></a>01440 <span class="stringliteral">                           where fd_id=$fd_id)"</span>);
<a name="l01441"></a>01441   <a class="code" href="setup_8php.html#a14">$M</a>=pg_NumRows($Res);
<a name="l01442"></a>01442 
<a name="l01443"></a>01443   <span class="comment">// Show the unused attribute</span>
<a name="l01444"></a>01444   echo '&lt;TR&gt; &lt;TD&gt;';
<a name="l01445"></a>01445   echo '&lt;SELECT NAME=<span class="stringliteral">"ad_id"</span>&gt;';
<a name="l01446"></a>01446   <span class="keywordflow">for</span> ($i=0;$i&lt;$M;$i++) {
<a name="l01447"></a>01447     <a class="code" href="bank_8inc_8php.html#a24">$l</a>=pg_fetch_array($Res,$i);
<a name="l01448"></a>01448     printf('&lt;OPTION VALUE=<span class="stringliteral">"%s"</span>&gt; %s',
<a name="l01449"></a>01449            $l['ad_id'],$l['ad_text']);
<a name="l01450"></a>01450   }
<a name="l01451"></a>01451   echo '&lt;/SELECT&gt;';
<a name="l01452"></a>01452   echo '&lt;/TD&gt;&lt;TD&gt; &lt;INPUT TYPE=<span class="stringliteral">"SUBMIT"</span> Value=<span class="stringliteral">"Add that line"</span> NAME=<span class="stringliteral">"add_ligne"</span>&gt;&lt;/TD&gt;&lt;/TR&gt;';
<a name="l01453"></a>01453   printf(<span class="stringliteral">"&lt;/TABLE&gt;"</span>);
<a name="l01454"></a>01454   echo '&lt;/<a class="code" href="constant_8php.html#a7">FORM</a>&gt;';
<a name="l01455"></a>01455 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1"></a><!-- doxytag: member="fiche_inc.php::EncodeFiche" ref="a1" args="($p_cn, $p_type, $p_array=null)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">EncodeFiche           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_type</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_array</em> = <code>null</code></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Affiche les détails d'une fiche et propose de mettre à jour ou si array est a null, permet d'ajouter une fiche, to fill the attribute. 
<p>
EncodeFiche<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$p_cn</em>&nbsp;</td><td>connexion </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$p_type</em>&nbsp;</td><td>id du modele fiche_def(fd_id) de la fiche SI array est null sinon correspond au id d'une fiche fiche(f_id)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Note:</b></dt><dd>STAN: je ne trouve pas le nom "EncodeFiche" super claire pour une fonction qui affiche les détails d'une fiche... on ne changerait pas en "DisplayFiche" ?  <p>
DANY: Oui je suis assez d'accord avec toi</dd></dl>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l00225">225</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="balance_8php-source.html#l00113">$a</a>, <a class="el" href="jrn__detail_8php-source.html#l00124">$l_line</a>, <a class="el" href="pref_8inc_8php-source.html#l00139">$label</a>, <a class="el" href="setup_8php-source.html#l00404">$Max</a>, <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="bank_8inc_8php-source.html#l00169">$sql</a>, <a class="el" href="admin_8inc_8php-source.html#l00112">$url</a>, <a class="el" href="debug_8php-source.html#l00034">echo_debug()</a>, <a class="el" href="ac__common_8php-source.html#l00036">echo_error()</a>, <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>, <a class="el" href="facture_8inc_8php-source.html#l00227">f_id</a>, <a class="el" href="postgres_8php-source.html#l00353">GetArray()</a>, <a class="el" href="fiche__inc_8php-source.html#l01028">getFicheNameById()</a>, <a class="el" href="action_8inc_8php-source.html#l00240">name</a>, and <a class="el" href="action_8inc_8php-source.html#l00241">value</a>.
<p>
Referenced by <a class="el" href="fiche__inc_8php-source.html#l00510">ViewFicheDetail()</a>.<div class="fragment"><pre class="fragment"><a name="l00225"></a>00225                                                   {
<a name="l00226"></a>00226   <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"function EncodeFiche($p_cn,$p_type) "</span>);
<a name="l00227"></a>00227 
<a name="l00228"></a>00228   $ch_col=<span class="stringliteral">"&lt;/TD&gt;&lt;TD&gt;"</span>;
<a name="l00229"></a>00229   $ch_li='&lt;/TR&gt;&lt;TR&gt;';
<a name="l00230"></a>00230   <a class="code" href="admin_8inc_8php.html#a3">$url</a>=<span class="stringliteral">""</span>;
<a name="l00231"></a>00231   <span class="comment">// compute url </span>
<a name="l00232"></a>00232   <span class="comment">// Bug 15640 : add get variabe to see the list of card after insertng a new one</span>
<a name="l00233"></a>00233   <span class="comment">//             or retrieve the fd_id when updating</span>
<a name="l00234"></a>00234   <span class="keywordflow">if</span> ($p_array == null) {
<a name="l00235"></a>00235     <a class="code" href="admin_8inc_8php.html#a3">$url</a>=<span class="stringliteral">"?action=vue&amp;fiche=$p_type"</span>;
<a name="l00236"></a>00236   } <span class="keywordflow">else</span> {
<a name="l00237"></a>00237     <span class="comment">// find the modele of card (fd_id)</span>
<a name="l00238"></a>00238     <a class="code" href="balance_8php.html#a10">$a</a>=<a class="code" href="postgres_8php.html#a23">GetArray</a>($p_cn,'select fd_id from <a class="code" href="classfiche.html">fiche</a> where <a class="code" href="facture_8inc_8php.html#a26">f_id</a>='.$p_type);
<a name="l00239"></a>00239     <span class="keywordflow">if</span> ( $a == null ) {
<a name="l00240"></a>00240       <a class="code" href="ac__common_8php.html#a0">echo_error</a>(__FILE__.<span class="stringliteral">":"</span>.__LINE__.<span class="stringliteral">" Aucune fiche trouvée"</span>);
<a name="l00241"></a>00241       <span class="keywordflow">return</span>;
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243     <a class="code" href="admin_8inc_8php.html#a3">$url</a>=<span class="stringliteral">"?action=vue&amp;fiche="</span>.$a[0]['fd_id'];
<a name="l00244"></a>00244   }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 
<a name="l00247"></a>00247   echo '&lt;<a class="code" href="constant_8php.html#a7">FORM</a> <a class="code" href="classaction.html">action</a>=<span class="stringliteral">"fiche.php'.$url.'"</span> method=<span class="stringliteral">"post"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"fiche"</span>&gt;';
<a name="l00248"></a>00248   echo '&lt;INPUT TYPE=<span class="stringliteral">"HIDDEN"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"fiche"</span> <a class="code" href="action_8inc_8php.html#a19">value</a>=<span class="stringliteral">"'.$p_type.'"</span>&gt;';
<a name="l00249"></a>00249   $l_sessid=$_REQUEST['PHPSESSID'];
<a name="l00250"></a>00250   <a class="code" href="admin_8inc_8php.html#a3">$url</a>=<span class="stringliteral">""</span>;
<a name="l00251"></a>00251   echo <a class="code" href="constant_8php.html#a80">JS_SHOW_TVA</a>;
<a name="l00252"></a>00252   echo <a class="code" href="constant_8php.html#a79">JS_SEARCH_POSTE</a>;
<a name="l00253"></a>00253   echo <span class="stringliteral">"&lt;TABLE&gt;"</span>;
<a name="l00254"></a>00254   <span class="keywordflow">if</span> ($p_array == null) {
<a name="l00255"></a>00255    
<a name="l00256"></a>00256     <span class="comment">// Array is null so we display a blank form</span>
<a name="l00257"></a>00257     <span class="comment">//    echo '&lt;H2 class="info"&gt;'.getFicheName($p_cn,$p_type).'&lt;/H2&gt;';</span>
<a name="l00258"></a>00258     echo '&lt;H2 <span class="keyword">class</span>=<span class="stringliteral">"info"</span>&gt;New &lt;/H2&gt;';
<a name="l00259"></a>00259     $p_f_id=<span class="stringliteral">""</span>;
<a name="l00260"></a>00260     <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"Array is null"</span>);
<a name="l00261"></a>00261     <span class="comment">// Find all the attribute of the existing cards</span>
<a name="l00262"></a>00262     <span class="comment">// --&gt; Get_attr_def </span>
<a name="l00263"></a>00263     <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=<span class="stringliteral">"select frd_id,ad_id,ad_text from  fiche_def join jnt_fic_attr using (fd_id)</span>
<a name="l00264"></a>00264 <span class="stringliteral">           join attr_def using (ad_id) where fd_id="</span>.$p_type.<span class="stringliteral">" order by ad_id"</span>;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l00267"></a>00267     <a class="code" href="setup_8php.html#a11">$Max</a>=pg_NumRows($Res);
<a name="l00268"></a>00268     <span class="comment">// Put the card modele id (fiche_def.fd_id)</span>
<a name="l00269"></a>00269     echo '&lt;INPUT TYPE=<span class="stringliteral">"HIDDEN"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"fd_id"</span> <a class="code" href="action_8inc_8php.html#a19">value</a>=<span class="stringliteral">"'.$p_type.'"</span>&gt;';
<a name="l00270"></a>00270     <span class="keywordflow">for</span> ($i=0;$i &lt; $Max;$i++) {
<a name="l00271"></a>00271       <a class="code" href="jrn__detail_8php.html#a11">$l_line</a>=pg_fetch_array($Res,$i);
<a name="l00272"></a>00272 
<a name="l00273"></a>00273       <span class="comment">// The number of the attribute</span>
<a name="l00274"></a>00274       $Hid=sprintf('&lt;INPUT TYPE=<span class="stringliteral">"HIDDEN"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"ad_id%d"</span> <a class="code" href="action_8inc_8php.html#a19">value</a>=<span class="stringliteral">"%s"</span>&gt;',
<a name="l00275"></a>00275                    $i,$l_line['ad_id']);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277       $but_search_poste=<span class="stringliteral">""</span>;
<a name="l00278"></a>00278       <span class="comment">// Javascript for searching the account</span>
<a name="l00279"></a>00279       <span class="keywordflow">if</span> ( $l_line ['ad_id'] == <a class="code" href="constant_8php.html#a55">ATTR_DEF_ACCOUNT</a> ) {
<a name="l00280"></a>00280         $ctl_name=<span class="stringliteral">"av_text$i"</span>;
<a name="l00281"></a>00281         $but_search_poste='&lt;INPUT TYPE=<span class="stringliteral">"BUTTON"</span> VALUE=<span class="stringliteral">"Cherche"</span> OnClick=<span class="stringliteral">"SearchPoste(\''.$l_sessid.'\',\''.$ctl_name.'\')"</span>&gt;';
<a name="l00282"></a>00282       } 
<a name="l00283"></a>00283       <span class="comment">// Javascript for showing the tva</span>
<a name="l00284"></a>00284       <span class="keywordflow">if</span> ( $l_line ['ad_id'] == <a class="code" href="constant_8php.html#a59">ATTR_DEF_TVA</a> ) {
<a name="l00285"></a>00285         $but_search_poste='&lt;INPUT TYPE=<span class="stringliteral">"BUTTON"</span> VALUE=<span class="stringliteral">"Montre"</span> OnClick=<span class="stringliteral">"ShowTva(\''.$l_sessid.'\', \'av_text'.$i.'\')"</span>&gt;';
<a name="l00286"></a>00286       }
<a name="l00287"></a>00287       <span class="comment">// content of the attribute</span>
<a name="l00288"></a>00288       printf ('&lt;TR&gt;&lt;TD&gt; %s &lt;/TD&gt;&lt;TD&gt;&lt;INPUT TYPE=<span class="stringliteral">"TEXT"</span> NAME=<span class="stringliteral">"av_text%d"</span>&gt;%s %s&lt;/TD&gt;&lt;/TR&gt;',
<a name="l00289"></a>00289               $l_line['ad_text'], $i,$Hid,$but_search_poste);
<a name="l00290"></a>00290    }
<a name="l00291"></a>00291     echo '&lt;/TR&gt;';
<a name="l00292"></a>00292     echo '&lt;/TABLE&gt;';
<a name="l00293"></a>00293     echo '&lt;INPUT TYPE=<span class="stringliteral">"HIDDEN"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"inc"</span> <a class="code" href="action_8inc_8php.html#a19">value</a>=<span class="stringliteral">"'.$Max.'"</span>&gt;';
<a name="l00294"></a>00294     echo '&lt;INPUT TYPE=<span class="stringliteral">"SUBMIT"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"add_fiche"</span> <a class="code" href="action_8inc_8php.html#a19">value</a>=<span class="stringliteral">"ajoute"</span>&gt;';
<a name="l00295"></a>00295     echo '&lt;/<a class="code" href="constant_8php.html#a7">FORM</a>&gt;';
<a name="l00296"></a>00296   }<span class="keywordflow">else</span> {
<a name="l00297"></a>00297     <span class="comment">// Array is not null so we have to find the card's data from the database</span>
<a name="l00298"></a>00298     <span class="comment">// and display them</span>
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="comment">// Display the card name</span>
<a name="l00301"></a>00301     <a class="code" href="pref_8inc_8php.html#a6">$label</a>=<a class="code" href="fiche__inc_8php.html#a15">getFicheNameById</a>($p_cn,$p_type);
<a name="l00302"></a>00302     echo '&lt;H2 <span class="keyword">class</span>=<span class="stringliteral">"info"</span>&gt;'.$label.'&lt;/H2&gt;';
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     <span class="comment">// Find all the data related to the card</span>
<a name="l00305"></a>00305     <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=<span class="stringliteral">"select av_text,ad_id,ad_text,jft_id from attr_value</span>
<a name="l00306"></a>00306 <span class="stringliteral">        natural join attr_def </span>
<a name="l00307"></a>00307 <span class="stringliteral">        natural join jnt_fic_att_value </span>
<a name="l00308"></a>00308 <span class="stringliteral">        natural join fiche where f_id=$p_type order by ad_id"</span>;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l00311"></a>00311     <a class="code" href="setup_8php.html#a11">$Max</a>=pg_NumRows($Res);
<a name="l00312"></a>00312     <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"Max ==== $Max"</span>);    
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     echo '&lt;INPUT TYPE=<span class="stringliteral">"HIDDEN"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"f_id"</span> <a class="code" href="action_8inc_8php.html#a19">value</a>=<span class="stringliteral">"'.$p_type.'"</span>&gt;';
<a name="l00315"></a>00315     echo '&lt;INPUT TYPE=<span class="stringliteral">"HIDDEN"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"f_label"</span> <a class="code" href="action_8inc_8php.html#a19">value</a>=<span class="stringliteral">"'.$label.'"</span>&gt;';
<a name="l00316"></a>00316     echo '&lt;INPUT TYPE=<span class="stringliteral">"HIDDEN"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"max"</span> <a class="code" href="action_8inc_8php.html#a19">value</a>=<span class="stringliteral">"'.$Max.'"</span>&gt;';
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     <span class="keywordflow">for</span> ($i=0;$i &lt; $Max;$i++) {
<a name="l00319"></a>00319       <span class="comment">// fetch the data</span>
<a name="l00320"></a>00320       <a class="code" href="jrn__detail_8php.html#a11">$l_line</a>=pg_fetch_array($Res,$i);
<a name="l00321"></a>00321 
<a name="l00322"></a>00322       <span class="comment">// Put also the class in a special variable</span>
<a name="l00323"></a>00323       <span class="comment">// useful when we want to update the PCMN</span>
<a name="l00324"></a>00324 
<a name="l00325"></a>00325       $but_search_poste=<span class="stringliteral">""</span>;
<a name="l00326"></a>00326       <span class="keywordflow">if</span> ( $l_line['ad_id'] == <a class="code" href="constant_8php.html#a55">ATTR_DEF_ACCOUNT</a> ) {
<a name="l00327"></a>00327         printf('&lt;INPUT TYPE=<span class="stringliteral">"HIDDEN"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"class"</span> <a class="code" href="action_8inc_8php.html#a19">value</a>=<span class="stringliteral">"%s"</span>&gt;',
<a name="l00328"></a>00328                $l_line['av_text']);
<a name="l00329"></a>00329       <span class="comment">// Javascript for searching the account</span>
<a name="l00330"></a>00330         $ctl_name=<span class="stringliteral">"av_text$i"</span>;
<a name="l00331"></a>00331         $but_search_poste='&lt;INPUT TYPE=<span class="stringliteral">"BUTTON"</span> VALUE=<span class="stringliteral">"Cherche"</span> OnClick=<span class="stringliteral">"SearchPoste(\''.$l_sessid.'\',\''.$ctl_name.'\')"</span>&gt;';
<a name="l00332"></a>00332       } 
<a name="l00333"></a>00333         
<a name="l00334"></a>00334       <span class="comment">// Javascript for showing the tva</span>
<a name="l00335"></a>00335       <span class="keywordflow">if</span> ( $l_line ['ad_id'] == <a class="code" href="constant_8php.html#a59">ATTR_DEF_TVA</a> ) {
<a name="l00336"></a>00336         $but_search_poste='&lt;INPUT TYPE=<span class="stringliteral">"BUTTON"</span> VALUE=<span class="stringliteral">"Montre"</span> OnClick=<span class="stringliteral">"ShowTva(\''.$l_sessid.'\',\'av_text'.$i.'\')"</span>&gt;';
<a name="l00337"></a>00337       }
<a name="l00338"></a>00338       
<a name="l00339"></a>00339       <span class="comment">// hide ad_id</span>
<a name="l00340"></a>00340       $ad=sprintf('&lt;input type=<span class="stringliteral">"hidden"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"ad_id%d"</span> <a class="code" href="action_8inc_8php.html#a19">value</a>=<span class="stringliteral">"%s"</span>&gt;',
<a name="l00341"></a>00341                   $l_line['ad_id'],$l_line['av_text']);
<a name="l00342"></a>00342       
<a name="l00343"></a>00343       <span class="comment">// in hidden we put the jft_id</span>
<a name="l00344"></a>00344       $Hid=sprintf('&lt;INPUT TYPE=<span class="stringliteral">"HIDDEN"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"jft_id%d"</span> <a class="code" href="action_8inc_8php.html#a19">value</a>=<span class="stringliteral">"%s"</span>&gt;',
<a name="l00345"></a>00345                    $i,$l_line['jft_id']);
<a name="l00346"></a>00346       printf ('&lt;TR&gt;&lt;TD&gt; %s &lt;/TD&gt;&lt;TD&gt;&lt;INPUT TYPE=<span class="stringliteral">"TEXT"</span> NAME=<span class="stringliteral">"av_text%d"</span> VALUE=<span class="stringliteral">"%s"</span>&gt;%s %s %s&lt;/TD&gt;&lt;/TR&gt;',
<a name="l00347"></a>00347               $l_line['ad_text'], $i, $l_line['av_text'],$Hid,$but_search_poste,$ad);
<a name="l00348"></a>00348       
<a name="l00349"></a>00349     }
<a name="l00350"></a>00350     echo '&lt;/TR&gt;';
<a name="l00351"></a>00351     echo '&lt;/TABLE&gt;';
<a name="l00352"></a>00352     echo '&lt;INPUT TYPE=<span class="stringliteral">"SUBMIT"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"update_fiche"</span> <a class="code" href="action_8inc_8php.html#a19">value</a>=<span class="stringliteral">"Mis à jour"</span>&gt;';
<a name="l00353"></a>00353     echo '&lt;/<a class="code" href="constant_8php.html#a7">FORM</a>&gt;';
<a name="l00354"></a>00354   }
<a name="l00355"></a>00355 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8"></a><!-- doxytag: member="fiche_inc.php::EncodeModele" ref="a8" args="($p_js)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">EncodeModele           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>p_js</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
parm :<ul>
<li>gen :</li><li>return:</li><li></li></ul>

<p>
EncodeModele
<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l00682">682</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="pref_8inc_8php-source.html#l00048">METHOD</a>, and <a class="el" href="action_8inc_8php-source.html#l00240">name</a>.<div class="fragment"><pre class="fragment"><a name="l00683"></a>00683 {
<a name="l00684"></a>00684   echo '&lt;H2 CLASS=<span class="stringliteral">"info"</span>&gt; Ajout d\'un modèle&lt;/H2&gt;';
<a name="l00685"></a>00685   echo '&lt;<a class="code" href="constant_8php.html#a7">FORM</a> <a class="code" href="constant_8php.html#a44">ACTION</a>=<span class="stringliteral">"fiche.php"</span> <a class="code" href="pref_8inc_8php.html#a0">METHOD</a>=<span class="stringliteral">"post"</span>&gt;';
<a name="l00686"></a>00686   echo '&lt;BR&gt;Libellé &lt;INPUT TYPE=<span class="stringliteral">"TEXT"</span> NAME=<span class="stringliteral">"nom_mod"</span>&gt;';
<a name="l00687"></a>00687   echo '&lt;BR&gt;Classe de base &lt;INPUT TYPE=<span class="stringliteral">"TEXT"</span> NAME=<span class="stringliteral">"class_base"</span>&gt;';
<a name="l00688"></a>00688   echo $p_js;
<a name="l00689"></a>00689   echo '&lt;INPUT TYPE=<span class="stringliteral">"HIDDEN"</span> NAME=<span class="stringliteral">"inc"</span> VALUE=<span class="stringliteral">"1"</span>&gt;';
<a name="l00690"></a>00690   echo '&lt;BR&gt;&lt;INPUT TYPE=<span class="stringliteral">"SUBMIT"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"record_model"</span> VALUE=<span class="stringliteral">"Ajoute modèle"</span>&gt;';
<a name="l00691"></a>00691   echo '&lt;/<a class="code" href="constant_8php.html#a7">FORM</a>&gt;';
<a name="l00692"></a>00692 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a20"></a><!-- doxytag: member="fiche_inc.php::Get_attr_def" ref="a20" args="($p_cn, $p_fiche_def)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">Get_attr_def           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_fiche_def</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
retrieve the fields of the card model 
<p>
Get_attr_def<p>
parm :<ul>
<li>$p_cn database connexion</li></ul>
<p>
$p_fiche_def_ref fiche_def.fd_id gen :<ul>
<li>return: array of ad_id (attr_def.ad_id) and labels (attr_def.ad_text)</li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01199">1199</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="recherche_8php-source.html#l00066">$array</a>, <a class="el" href="balance_8php-source.html#l00118">$i</a>, <a class="el" href="fortis__be_8inc_8php-source.html#l00076">$Num</a>, <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="eub__be_8inc_8php-source.html#l00055">$Sql</a>, and <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>.
<p>
Referenced by <a class="el" href="fiche__inc_8php-source.html#l00038">AddFiche()</a>.<div class="fragment"><pre class="fragment"><a name="l01199"></a>01199                                           {
<a name="l01200"></a>01200   <span class="comment">// find the min attr for the fiche_def_ref</span>
<a name="l01201"></a>01201   <a class="code" href="eub__be_8inc_8php.html#a4">$Sql</a>=<span class="stringliteral">"select ad_id,ad_text from attr_def </span>
<a name="l01202"></a>01202 <span class="stringliteral">         natural join jnt_fic_attr</span>
<a name="l01203"></a>01203 <span class="stringliteral">         natural join fiche_def</span>
<a name="l01204"></a>01204 <span class="stringliteral">      where</span>
<a name="l01205"></a>01205 <span class="stringliteral">      fd_id= $p_fiche_def order by ad_id"</span>;
<a name="l01206"></a>01206   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$Sql);
<a name="l01207"></a>01207   <a class="code" href="fortis__be_8inc_8php.html#a9">$Num</a>=pg_NumRows($Res);
<a name="l01208"></a>01208 
<a name="l01209"></a>01209   <span class="comment">// test the number of returned rows</span>
<a name="l01210"></a>01210   <span class="keywordflow">if</span> ($Num == 0 ) <span class="keywordflow">return</span> null;
<a name="l01211"></a>01211 
<a name="l01212"></a>01212   <span class="comment">// Get Results &amp; Store them in a array</span>
<a name="l01213"></a>01213   <span class="keywordflow">for</span> ($i=0;$i&lt;$Num;$i++) {
<a name="l01214"></a>01214     $f=pg_fetch_array($Res,$i);
<a name="l01215"></a>01215     <a class="code" href="recherche_8php.html#a4">$array</a>[<a class="code" href="balance_8php.html#a12">$i</a>]['ad_id']=$f['ad_id'];
<a name="l01216"></a>01216     <a class="code" href="recherche_8php.html#a4">$array</a>[<a class="code" href="balance_8php.html#a12">$i</a>]['ad_text']=$f['ad_text'];
<a name="l01217"></a>01217   }
<a name="l01218"></a>01218   <span class="keywordflow">return</span> <a class="code" href="recherche_8php.html#a4">$array</a>;
<a name="l01219"></a>01219 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a19"></a><!-- doxytag: member="fiche_inc.php::Get_attr_min" ref="a19" args="($p_cn, $p_fiche_def_ref)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">Get_attr_min           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_fiche_def_ref</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
retrieve the mandatory field of the card model 
<p>
Get_attr_min<p>
parm :<ul>
<li>$p_cn database connexion</li></ul>
<p>
$p_fiche_def_ref gen :<ul>
<li>return: array of ad_id (attr_min.ad_id) and labels (attr_def.ad_text)</li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01167">1167</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="recherche_8php-source.html#l00066">$array</a>, <a class="el" href="balance_8php-source.html#l00118">$i</a>, <a class="el" href="fortis__be_8inc_8php-source.html#l00076">$Num</a>, <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="eub__be_8inc_8php-source.html#l00055">$Sql</a>, and <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>.
<p>
Referenced by <a class="el" href="fiche__inc_8php-source.html#l00779">AddModele()</a>.<div class="fragment"><pre class="fragment"><a name="l01167"></a>01167                                               {
<a name="l01168"></a>01168   <span class="comment">// find the min attr for the fiche_def_ref</span>
<a name="l01169"></a>01169   <a class="code" href="eub__be_8inc_8php.html#a4">$Sql</a>=<span class="stringliteral">"select ad_id,ad_text from attr_min natural join attr_def </span>
<a name="l01170"></a>01170 <span class="stringliteral">         natural join fiche_def_ref</span>
<a name="l01171"></a>01171 <span class="stringliteral">      where</span>
<a name="l01172"></a>01172 <span class="stringliteral">      frd_id= $p_fiche_def_ref"</span>;
<a name="l01173"></a>01173   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$Sql);
<a name="l01174"></a>01174   <a class="code" href="fortis__be_8inc_8php.html#a9">$Num</a>=pg_NumRows($Res);
<a name="l01175"></a>01175 
<a name="l01176"></a>01176   <span class="comment">// test the number of returned rows</span>
<a name="l01177"></a>01177   <span class="keywordflow">if</span> ($Num == 0 ) <span class="keywordflow">return</span> null;
<a name="l01178"></a>01178 
<a name="l01179"></a>01179   <span class="comment">// Get Results &amp; Store them in a array</span>
<a name="l01180"></a>01180   <span class="keywordflow">for</span> ($i=0;$i&lt;$Num;$i++) {
<a name="l01181"></a>01181     $f=pg_fetch_array($Res,$i);
<a name="l01182"></a>01182     <a class="code" href="recherche_8php.html#a4">$array</a>[<a class="code" href="balance_8php.html#a12">$i</a>]['ad_id']=$f['ad_id'];
<a name="l01183"></a>01183     <a class="code" href="recherche_8php.html#a4">$array</a>[<a class="code" href="balance_8php.html#a12">$i</a>]['ad_text']=$f['ad_text'];
<a name="l01184"></a>01184   }
<a name="l01185"></a>01185   <span class="keywordflow">return</span> <a class="code" href="recherche_8php.html#a4">$array</a>;
<a name="l01186"></a>01186 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a18"></a><!-- doxytag: member="fiche_inc.php::Get_fiche_def_ref" ref="a18" args="($p_cn)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">Get_fiche_def_ref           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>p_cn</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
return an array containing all the data contained in the table <a class="el" href="classfiche__def__ref.html">fiche_def_ref</a> parm :<ul>
<li>$p_cn connection to the database gen :</li><li>none return: array if ok null otherwize </li></ul>

<p>
Get_fiche_def_ref
<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01133">1133</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="recherche_8php-source.html#l00066">$array</a>, <a class="el" href="balance_8php-source.html#l00118">$i</a>, <a class="el" href="setup_8php-source.html#l00404">$Max</a>, <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>, <a class="el" href="fiche__def_8inc_8php-source.html#l00032">frd_class_base</a>, <a class="el" href="fiche__def_8inc_8php-source.html#l00030">frd_id</a>, and <a class="el" href="fiche__def_8inc_8php-source.html#l00031">frd_text</a>.
<p>
Referenced by <a class="el" href="fiche__inc_8php-source.html#l00707">DefModele()</a>.<div class="fragment"><pre class="fragment"><a name="l01134"></a>01134 {
<a name="l01135"></a>01135   <span class="comment">// get all the data from fiche_def_ref</span>
<a name="l01136"></a>01136   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn, <span class="stringliteral">"select frd_id,frd_text,frd_class_base </span>
<a name="l01137"></a>01137 <span class="stringliteral">                          from fiche_def_ref</span>
<a name="l01138"></a>01138 <span class="stringliteral">                       order by frd_text"</span>);
<a name="l01139"></a>01139 
<a name="l01140"></a>01140   <span class="comment">// check if the result is valid</span>
<a name="l01141"></a>01141   <a class="code" href="setup_8php.html#a11">$Max</a>=pg_NumRows($Res);
<a name="l01142"></a>01142   <span class="keywordflow">if</span> ( $Max == 0) <span class="keywordflow">return</span> null;
<a name="l01143"></a>01143 
<a name="l01144"></a>01144   <span class="comment">// store the result in a array</span>
<a name="l01145"></a>01145   <span class="keywordflow">for</span> ($i=0;$i&lt;$Max;$i++) {
<a name="l01146"></a>01146     $f=pg_fetch_array($Res,$i);
<a name="l01147"></a>01147     <a class="code" href="recherche_8php.html#a4">$array</a>[<a class="code" href="balance_8php.html#a12">$i</a>]['<span class="keywordtype">id</span>']=$f['<a class="code" href="fiche__def_8inc_8php.html#a1">frd_id</a>'];
<a name="l01148"></a>01148     <a class="code" href="recherche_8php.html#a4">$array</a>[<a class="code" href="balance_8php.html#a12">$i</a>]['text']=$f['<a class="code" href="fiche__def_8inc_8php.html#a2">frd_text</a>'];
<a name="l01149"></a>01149     <a class="code" href="recherche_8php.html#a4">$array</a>[<a class="code" href="balance_8php.html#a12">$i</a>]['<span class="keyword">class</span>']=$f['<a class="code" href="fiche__def_8inc_8php.html#a3">frd_class_base</a>'];
<a name="l01150"></a>01150   }
<a name="l01151"></a>01151 
<a name="l01152"></a>01152   <span class="comment">// return result</span>
<a name="l01153"></a>01153   <span class="keywordflow">return</span> <a class="code" href="recherche_8php.html#a4">$array</a>;
<a name="l01154"></a>01154 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2"></a><!-- doxytag: member="fiche_inc.php::GetBaseFiche" ref="a2" args="($p_cn, $p_type)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">GetBaseFiche           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_type</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
donne la classe comptable de base d'une fiche 
<p>
GetBaseFiche<p>
parm :<ul>
<li>p_cn connexion</li></ul>
<p>
p_type fiche id gen :<ul>
<li>none return:</li><li>return la classe id ou rien</li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l00370">370</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, and <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>.
<p>
Referenced by <a class="el" href="fiche__inc_8php-source.html#l00038">AddFiche()</a>.<div class="fragment"><pre class="fragment"><a name="l00370"></a>00370                                      {
<a name="l00371"></a>00371   $base=null;
<a name="l00372"></a>00372   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"select fd_class_base from fiche_def where fd_id="</span>.$p_type);
<a name="l00373"></a>00373   <span class="keywordflow">if</span> ( pg_NumRows($Res) == 0 ) <span class="keywordflow">return</span> null;
<a name="l00374"></a>00374   $base=pg_fetch_array($Res,0);
<a name="l00375"></a>00375   <span class="keywordflow">return</span> $base['fd_class_base'];
<a name="l00376"></a>00376 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a3"></a><!-- doxytag: member="fiche_inc.php::GetBaseFicheDefault" ref="a3" args="($p_cn, $p_type)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">GetBaseFicheDefault           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_type</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Give the default accounts of <a class="el" href="classfiche__def.html">fiche_def</a>. 
<p>
GetBaseFicheDefault<p>
parm :<ul>
<li>p_cn connexion</li></ul>
<p>
p_type fiche id gen :<ul>
<li>none return:</li><li>return la classe id ou rien</li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l00392">392</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>, and <a class="el" href="fiche__def_8inc_8php-source.html#l00032">frd_class_base</a>.
<p>
Referenced by <a class="el" href="fiche__inc_8php-source.html#l00779">AddModele()</a>.<div class="fragment"><pre class="fragment"><a name="l00392"></a>00392                                             {
<a name="l00393"></a>00393   $base=null;
<a name="l00394"></a>00394   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"select frd_class_base from fiche_def_ref where frd_id="</span>.$p_type);
<a name="l00395"></a>00395   <span class="keywordflow">if</span> ( pg_NumRows($Res) == 0 ) <span class="keywordflow">return</span> null;
<a name="l00396"></a>00396   $base=pg_fetch_array($Res,0);
<a name="l00397"></a>00397   <span class="keywordflow">return</span> $base['<a class="code" href="fiche__def_8inc_8php.html#a3">frd_class_base</a>'];
<a name="l00398"></a>00398 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a24"></a><!-- doxytag: member="fiche_inc.php::GetClass" ref="a24" args="($p_cn, $p_fid)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">GetClass           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_fid</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Retrieve the account of a card. 
<p>
GetClass<p>
parm :<ul>
<li>connection</li></ul>
<p>
card id (<a class="el" href="facture_8inc_8php.html#a26">fiche.f_id</a>) gen :<ul>
<li>none return: string if a class if found or null otherwise</li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01331">1331</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="bank_8inc_8php-source.html#l00169">$sql</a>, <a class="el" href="debug_8php-source.html#l00034">echo_debug()</a>, and <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>.
<p>
Referenced by <a class="el" href="fiche__inc_8php-source.html#l00956">Remove()</a>.<div class="fragment"><pre class="fragment"><a name="l01331"></a>01331                                 {
<a name="l01332"></a>01332   <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"GetClass($p_fid)"</span>);
<a name="l01333"></a>01333   
<a name="l01334"></a>01334   <span class="comment">// the account class is in the av_text with the ad_id=5 in </span>
<a name="l01335"></a>01335   <span class="comment">// attr_Def</span>
<a name="l01336"></a>01336   <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=<span class="stringliteral">"select av_text from attr_value </span>
<a name="l01337"></a>01337 <span class="stringliteral">                     natural join jnt_fic_att_value</span>
<a name="l01338"></a>01338 <span class="stringliteral">                      natural join attr_def </span>
<a name="l01339"></a>01339 <span class="stringliteral">                    where</span>
<a name="l01340"></a>01340 <span class="stringliteral">                      ad_id="</span>.ATTR_DEF_ACCOUNT.<span class="stringliteral">" and f_id=$p_fid"</span>;
<a name="l01341"></a>01341   <span class="comment">// Exec</span>
<a name="l01342"></a>01342   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l01343"></a>01343   <span class="keywordflow">if</span> (pg_NumRows($Res) == 0 ) <span class="keywordflow">return</span> null;
<a name="l01344"></a>01344 
<a name="l01345"></a>01345   <span class="comment">// Fetch the data and return it</span>
<a name="l01346"></a>01346   $f=pg_fetch_array($Res,0);
<a name="l01347"></a>01347   <span class="keywordflow">return</span> $f['av_text'];
<a name="l01348"></a>01348 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a21"></a><!-- doxytag: member="fiche_inc.php::GetCreateAccount" ref="a21" args="($p_cn, $p_fiche_def)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">GetCreateAccount           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_fiche_def</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
retrieve the fields of the card model which indicate if each cards needs its own account parm :<ul>
<li>$p_cn database connexion</li></ul>
<p>
$p_fiche_def_ref fiche_def.fd_id gen :<ul>
<li>return: not null if yes, each cards has its own account </li></ul>

<p>
GetCreateAccount
<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01232">1232</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="fortis__be_8inc_8php-source.html#l00076">$Num</a>, <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="eub__be_8inc_8php-source.html#l00055">$Sql</a>, <a class="el" href="debug_8php-source.html#l00034">echo_debug()</a>, and <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>.
<p>
Referenced by <a class="el" href="fiche__inc_8php-source.html#l00038">AddFiche()</a>, and <a class="el" href="fiche__inc_8php-source.html#l00956">Remove()</a>.<div class="fragment"><pre class="fragment"><a name="l01232"></a>01232                                               {
<a name="l01233"></a>01233   <span class="comment">// find the min attr for the fiche_def_ref</span>
<a name="l01234"></a>01234   <a class="code" href="eub__be_8inc_8php.html#a4">$Sql</a>=<span class="stringliteral">"select fd_create_account</span>
<a name="l01235"></a>01235 <span class="stringliteral">      from fiche_def</span>
<a name="l01236"></a>01236 <span class="stringliteral">        where</span>
<a name="l01237"></a>01237 <span class="stringliteral">      fd_id= $p_fiche_def"</span>;
<a name="l01238"></a>01238   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$Sql);
<a name="l01239"></a>01239   <a class="code" href="fortis__be_8inc_8php.html#a9">$Num</a>=pg_NumRows($Res);
<a name="l01240"></a>01240 
<a name="l01241"></a>01241   <span class="comment">// test the number of returned rows</span>
<a name="l01242"></a>01242   <span class="keywordflow">if</span> ($Num == 0 ) <span class="keywordflow">return</span> 0;
<a name="l01243"></a>01243 
<a name="l01244"></a>01244 
<a name="l01245"></a>01245   <span class="keywordflow">for</span> ($i=0;$i&lt;$Num;$i++) {
<a name="l01246"></a>01246     $f=pg_fetch_array($Res,$i);
<a name="l01247"></a>01247     <a class="code" href="debug_8php.html#a0">echo_debug</a> (<span class="stringliteral">"fd_create_account == "</span>.$f['fd_create_account']);
<a name="l01248"></a>01248     <span class="keywordflow">if</span> ( $f['fd_create_account']==<span class="charliteral">'t'</span>) {
<a name="l01249"></a>01249       <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"fd_create_account return 1"</span>);
<a name="l01250"></a>01250       <span class="keywordflow">return</span> 1;
<a name="l01251"></a>01251     }
<a name="l01252"></a>01252   }
<a name="l01253"></a>01253   <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"fd_create_account return 0"</span>);
<a name="l01254"></a>01254   <span class="keywordflow">return</span> 0;
<a name="l01255"></a>01255 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a12"></a><!-- doxytag: member="fiche_inc.php::GetDataModele" ref="a12" args="($p_cn, $p_fiche)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">GetDataModele           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_fiche</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Return the info of an fiche identified by p_fiche. 
<p>
GetDataModele<p>
parm :<ul>
<li>connection</li></ul>
<p>
fiche id gen :<ul>
<li>none return:</li><li>array with all the data</li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l00913">913</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="recherche_8php-source.html#l00066">$array</a>, <a class="el" href="argenta__be_8inc_8php-source.html#l00028">$line</a>, <a class="el" href="setup_8php-source.html#l00404">$Max</a>, <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>, and <a class="el" href="balance_8php-source.html#l00076">label</a>.
<p>
Referenced by <a class="el" href="fiche__inc_8php-source.html#l00887">UpdateModele()</a>.<div class="fragment"><pre class="fragment"><a name="l00913"></a>00913                                        {
<a name="l00914"></a>00914   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"select fd_class_base,ad_id,ad_text from </span>
<a name="l00915"></a>00915 <span class="stringliteral">                          fiche_def</span>
<a name="l00916"></a>00916 <span class="stringliteral">                          natural join jnt_fic_attr</span>
<a name="l00917"></a>00917 <span class="stringliteral">                          natural join attr_def</span>
<a name="l00918"></a>00918 <span class="stringliteral">                          where</span>
<a name="l00919"></a>00919 <span class="stringliteral">                          fd_id=$p_fiche"</span>);
<a name="l00920"></a>00920   <a class="code" href="setup_8php.html#a11">$Max</a>=pg_NumRows($Res) ;
<a name="l00921"></a>00921   <span class="keywordflow">if</span> ($Max==0) <span class="keywordflow">return</span> null;
<a name="l00922"></a>00922 
<a name="l00923"></a>00923   <span class="comment">// store the data in an array</span>
<a name="l00924"></a>00924   <span class="keywordflow">for</span> ($i=0; $i &lt; $Max;$i++) {
<a name="l00925"></a>00925     <a class="code" href="argenta__be_8inc_8php.html#a0">$line</a>=pg_fetch_array($Res,$i);
<a name="l00926"></a>00926     <span class="keywordflow">if</span> ($i == 0 ) {
<a name="l00927"></a>00927       <a class="code" href="recherche_8php.html#a4">$array</a>['<a class="code" href="balance_8php.html#a6">label</a>']=GetFicheDefName($p_cn,$p_fiche);
<a name="l00928"></a>00928       <a class="code" href="recherche_8php.html#a4">$array</a>['class_base']=<a class="code" href="argenta__be_8inc_8php.html#a0">$line</a>['fd_class_base'];
<a name="l00929"></a>00929       <a class="code" href="recherche_8php.html#a4">$array</a>['fd_id']=$p_fiche;
<a name="l00930"></a>00930     }<span class="comment">//if $i == 0</span>
<a name="l00931"></a>00931 
<a name="l00932"></a>00932     <span class="comment">//Label</span>
<a name="l00933"></a>00933     $text=sprintf(<span class="stringliteral">"ad_id%d"</span>,$i);
<a name="l00934"></a>00934     <a class="code" href="recherche_8php.html#a4">$array</a>[$text]=<a class="code" href="argenta__be_8inc_8php.html#a0">$line</a>['ad_id'];
<a name="l00935"></a>00935     <span class="comment">//isd_id</span>
<a name="l00936"></a>00936     $text=sprintf(<span class="stringliteral">"ad_text%d"</span>,$i);
<a name="l00937"></a>00937     <a class="code" href="recherche_8php.html#a4">$array</a>[$text]=<a class="code" href="argenta__be_8inc_8php.html#a0">$line</a>['ad_text'];
<a name="l00938"></a>00938 
<a name="l00939"></a>00939   }<span class="comment">//for</span>
<a name="l00940"></a>00940   <a class="code" href="recherche_8php.html#a4">$array</a>['ligne']=<a class="code" href="setup_8php.html#a11">$Max</a>;
<a name="l00941"></a>00941   <span class="keywordflow">return</span> <a class="code" href="recherche_8php.html#a4">$array</a>;
<a name="l00942"></a>00942 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a29"></a><!-- doxytag: member="fiche_inc.php::getFicheAttribut" ref="a29" args="($p_cn, $p_id, $p_attr=&quot;&quot;)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">getFicheAttribut           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_id</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_attr</em> = <code>&quot;&quot;</code></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
retrun array of attribut or string 
<p>
getFicheAttribut<p>
parm :<ul>
<li>p_cn connexion</li></ul>
<p>
p_id quick_code<ul>
<li>attribut if attribut == "" then return a array taken from vw_fiche_attr gen :<ul>
<li>none return:</li></ul>
</li></ul>
<p>
string avec nom fiche or array
<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01492">1492</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, and <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>.
<p>
Referenced by <a class="el" href="user__form__ach_8php-source.html#l00457">FormAchView()</a>, <a class="el" href="user__form__ven_8php-source.html#l00415">FormVenteView()</a>, and <a class="el" href="user__common_8php-source.html#l00631">withStock()</a>.<div class="fragment"><pre class="fragment"><a name="l01492"></a>01492                                                   {
<a name="l01493"></a>01493   <span class="comment">// Retrieve the attribute with the ad_id 1</span>
<a name="l01494"></a>01494   <span class="comment">// 1 is always the name</span>
<a name="l01495"></a>01495 
<a name="l01496"></a>01496   <span class="keywordflow">if</span> ( $p_attr != <span class="stringliteral">""</span>) {
<a name="l01497"></a>01497     <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"select av_text from </span>
<a name="l01498"></a>01498 <span class="stringliteral">                    attr_value</span>
<a name="l01499"></a>01499 <span class="stringliteral">                    natural join jnt_fic_att_value </span>
<a name="l01500"></a>01500 <span class="stringliteral">                    natural join fiche </span>
<a name="l01501"></a>01501 <span class="stringliteral">                    where</span>
<a name="l01502"></a>01502 <span class="stringliteral">                    ad_id=$p_attr </span>
<a name="l01503"></a>01503 <span class="stringliteral">                    and f_id=(select f_id from vw_poste_qcode where j_qcode='$p_id') "</span>);
<a name="l01504"></a>01504     <span class="keywordflow">if</span> ( pg_NumRows($Res) == 0 ) <span class="keywordflow">return</span> NULL;
<a name="l01505"></a>01505     $st=pg_fetch_array($Res,0);
<a name="l01506"></a>01506     <span class="keywordflow">return</span> $st['av_text'];
<a name="l01507"></a>01507   } <span class="keywordflow">else</span> {
<a name="l01508"></a>01508     <span class="comment">// Get attribut from the view</span>
<a name="l01509"></a>01509     <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"select * from vw_fiche_attr where quick_code='$p_id'"</span>);
<a name="l01510"></a>01510     <span class="keywordflow">if</span> ( pg_NumRows($Res) == 0 ) <span class="keywordflow">return</span> null;
<a name="l01511"></a>01511     $st=pg_fetch_array($Res,0);
<a name="l01512"></a>01512     <span class="keywordflow">return</span> $st;
<a name="l01513"></a>01513   }
<a name="l01514"></a>01514 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a23"></a><!-- doxytag: member="fiche_inc.php::GetFicheDef" ref="a23" args="($p_cn, $p_f_id)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">GetFicheDef           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_f_id</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
retrieve the fiche_def.fd_id thanks the f_id of a card 
<p>
GetFicheRef<p>
parm :<ul>
<li>$p_cn connection</li></ul>
<p>
$p_f_id <a class="el" href="facture_8inc_8php.html#a26">fiche.f_id</a> gen :<ul>
<li>none return:</li></ul>
<p>
the fiche_def.fd_id or null if nothing has been found
<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01300">1300</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="bank_8inc_8php-source.html#l00169">$sql</a>, and <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>.
<p>
Referenced by <a class="el" href="fiche__inc_8php-source.html#l00956">Remove()</a>, and <a class="el" href="fiche__inc_8php-source.html#l00510">ViewFicheDetail()</a>.<div class="fragment"><pre class="fragment"><a name="l01301"></a>01301 {
<a name="l01302"></a>01302   <span class="comment">// Sql stmt</span>
<a name="l01303"></a>01303   <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=<span class="stringliteral">"select fd_id from fiche_def join fiche using (fd_id) </span>
<a name="l01304"></a>01304 <span class="stringliteral">      where f_id=$p_f_id"</span>;
<a name="l01305"></a>01305   <span class="comment">// Execute it</span>
<a name="l01306"></a>01306   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l01307"></a>01307 
<a name="l01308"></a>01308   <span class="comment">// nothing is found</span>
<a name="l01309"></a>01309   <span class="keywordflow">if</span> ( pg_NumRows($Res) == 0 ) <span class="keywordflow">return</span> null;
<a name="l01310"></a>01310 
<a name="l01311"></a>01311   <span class="comment">// Fetch the data</span>
<a name="l01312"></a>01312   $f=pg_fetch_array($Res,0);
<a name="l01313"></a>01313 
<a name="l01314"></a>01314   <span class="comment">// return the value</span>
<a name="l01315"></a>01315   <span class="keywordflow">return</span> $f['fd_id'];
<a name="l01316"></a>01316 
<a name="l01317"></a>01317 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a16"></a><!-- doxytag: member="fiche_inc.php::getFicheDefName" ref="a16" args="($p_cn, $p_id)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">getFicheDefName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_id</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
retourne le nom de la cat. de fiches 
<p>
getFicheDefName<p>
parm :<ul>
<li>p_cn connexion</li></ul>
<p>
p_id fiche id fiche_def.fd_id gen :<ul>
<li>none return:</li></ul>
<p>
string fiche_def.fd_label
<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01056">1056</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, and <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>.<div class="fragment"><pre class="fragment"><a name="l01056"></a>01056                                       {
<a name="l01057"></a>01057   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"select fd_label from fiche_def where fd_id=$p_id"</span>);
<a name="l01058"></a>01058   <span class="keywordflow">if</span> ( pg_NumRows($Res) == 0 ) <span class="keywordflow">return</span> <span class="stringliteral">"Unknown"</span>;
<a name="l01059"></a>01059   $st=pg_fetch_array($Res,0);
<a name="l01060"></a>01060   <span class="keywordflow">return</span> $st['fd_label'];
<a name="l01061"></a>01061 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a22"></a><!-- doxytag: member="fiche_inc.php::GetFicheDefRef" ref="a22" args="($p_cn, $p_f_id)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">GetFicheDefRef           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_f_id</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
retrieve the <a class="el" href="fiche__def_8inc_8php.html#a1">fiche_def.frd_id</a> thanks the f_id of a card 
<p>
GetFicheDefRef<p>
parm :<ul>
<li>$p_cn connection</li></ul>
<p>
$p_f_id <a class="el" href="facture_8inc_8php.html#a26">fiche.f_id</a> gen :<ul>
<li>none return:</li></ul>
<p>
the <a class="el" href="fiche__def_8inc_8php.html#a1">fiche_def.frd_id</a> or null if nothing has been found
<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01269">1269</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="bank_8inc_8php-source.html#l00169">$sql</a>, <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>, and <a class="el" href="fiche__def_8inc_8php-source.html#l00030">frd_id</a>.
<p>
Referenced by <a class="el" href="fiche__inc_8php-source.html#l00548">UpdateFiche()</a>.<div class="fragment"><pre class="fragment"><a name="l01270"></a>01270 {
<a name="l01271"></a>01271   <span class="comment">// Sql stmt</span>
<a name="l01272"></a>01272   <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=<span class="stringliteral">"select frd_id from fiche_def join fiche using (fd_id) </span>
<a name="l01273"></a>01273 <span class="stringliteral">      where f_id=$p_f_id"</span>;
<a name="l01274"></a>01274   <span class="comment">// Execute it</span>
<a name="l01275"></a>01275   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l01276"></a>01276 
<a name="l01277"></a>01277   <span class="comment">// nothing is found</span>
<a name="l01278"></a>01278   <span class="keywordflow">if</span> ( pg_NumRows($Res) == 0 ) <span class="keywordflow">return</span> null;
<a name="l01279"></a>01279 
<a name="l01280"></a>01280   <span class="comment">// Fetch the data</span>
<a name="l01281"></a>01281   $f=pg_fetch_array($Res,0);
<a name="l01282"></a>01282 
<a name="l01283"></a>01283   <span class="comment">// return the value</span>
<a name="l01284"></a>01284   <span class="keywordflow">return</span> $f['<a class="code" href="fiche__def_8inc_8php.html#a1">frd_id</a>'];
<a name="l01285"></a>01285 
<a name="l01286"></a>01286 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a17"></a><!-- doxytag: member="fiche_inc.php::GetFicheJrn" ref="a17" args="($p_cn, $p_jrn, $p_type)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">GetFicheJrn           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_jrn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_type</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get all the fiche related to a "journal". 
<p>
GetFicheJrn<p>
parm :<ul>
<li>p_cn connextion</li></ul>
<p>
j_jrn journal_id<ul>
<li>$p_type : deb or cred gen :<ul>
<li>none return: array containing the fiche(f_id),fiche(f_label)</li></ul>
</li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01075">1075</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="balance_8php-source.html#l00113">$a</a>, <a class="el" href="balance_8php-source.html#l00118">$i</a>, <a class="el" href="argenta__be_8inc_8php-source.html#l00028">$line</a>, <a class="el" href="fiche__new_8php-source.html#l00136">$list</a>, <a class="el" href="setup_8php-source.html#l00404">$Max</a>, <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="bank_8inc_8php-source.html#l00169">$sql</a>, <a class="el" href="ac__common_8php-source.html#l00036">echo_error()</a>, <a class="el" href="ac__common_8php-source.html#l00267">echo_warning()</a>, <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>, <a class="el" href="balance_8php-source.html#l00036">exit</a>, and <a class="el" href="facture_8inc_8php-source.html#l00227">f_id</a>.<div class="fragment"><pre class="fragment"><a name="l01076"></a>01076 {
<a name="l01077"></a>01077   $get=<span class="stringliteral">""</span>;
<a name="l01078"></a>01078   <span class="keywordflow">if</span> ( $p_type == 'deb' ) {
<a name="l01079"></a>01079     $get='jrn_def_fiche_deb';
<a name="l01080"></a>01080   }
<a name="l01081"></a>01081   <span class="keywordflow">if</span> ( $p_type == 'cred' ) {
<a name="l01082"></a>01082     $get='jrn_def_fiche_cred';
<a name="l01083"></a>01083   }
<a name="l01084"></a>01084   <span class="keywordflow">if</span> ( $get == <span class="stringliteral">""</span> ) {
<a name="l01085"></a>01085     <a class="code" href="ac__common_8php.html#a0">echo_error</a>(<span class="stringliteral">"Invalid p_type function GetFicheJrn($p_cn,$p_jrn,$p_type)"</span>);
<a name="l01086"></a>01086     <a class="code" href="balance_8php.html#a0">exit</a> -1;
<a name="l01087"></a>01087   }
<a name="l01088"></a>01088   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"select $get as fiche from jrn_def where jrn_def_id=$p_jrn"</span>);
<a name="l01089"></a>01089   <a class="code" href="setup_8php.html#a11">$Max</a>=pg_NumRows($Res);
<a name="l01090"></a>01090   <span class="keywordflow">if</span> ( $Max==0) {
<a name="l01091"></a>01091     <a class="code" href="ac__common_8php.html#a11">echo_warning</a>(<span class="stringliteral">"No rows"</span>);
<a name="l01092"></a>01092     <span class="keywordflow">return</span> null;
<a name="l01093"></a>01093   }
<a name="l01094"></a>01094   <span class="comment">// Normally Max must be == 1</span>
<a name="l01095"></a>01095   <a class="code" href="fiche__new_8php.html#a7">$list</a>=pg_fetch_array($Res,0);
<a name="l01096"></a>01096   <span class="keywordflow">if</span> ( $list['<a class="code" href="classfiche.html">fiche</a>']==<span class="stringliteral">""</span>) {
<a name="l01097"></a>01097     <a class="code" href="ac__common_8php.html#a11">echo_warning</a>(<span class="stringliteral">"No fiche"</span>);
<a name="l01098"></a>01098     <span class="keywordflow">return</span> null;
<a name="l01099"></a>01099   }
<a name="l01100"></a>01100   
<a name="l01101"></a>01101  <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=<span class="stringliteral">"select f_id,av_text as f_label </span>
<a name="l01102"></a>01102 <span class="stringliteral">        from fiche natural join jnt_fic_att_value</span>
<a name="l01103"></a>01103 <span class="stringliteral">        natural join attr_def</span>
<a name="l01104"></a>01104 <span class="stringliteral">        natural join attr_value</span>
<a name="l01105"></a>01105 <span class="stringliteral">        natural join fiche_def</span>
<a name="l01106"></a>01106 <span class="stringliteral">        where ad_id=1 and</span>
<a name="l01107"></a>01107 <span class="stringliteral">           fd_id in ("</span>.$list['<a class="code" href="classfiche.html">fiche</a>'].<span class="stringliteral">")  order by f_label"</span>;
<a name="l01108"></a>01108 
<a name="l01109"></a>01109   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l01110"></a>01110   <a class="code" href="setup_8php.html#a11">$Max</a>=pg_NumRows($Res);
<a name="l01111"></a>01111   <span class="keywordflow">if</span> ($Max==0 ) <span class="keywordflow">return</span> null;
<a name="l01112"></a>01112   <span class="comment">// Get The result and put it into an array</span>
<a name="l01113"></a>01113   <span class="keywordflow">for</span> ($i=0;$i&lt;$Max;$i++) {
<a name="l01114"></a>01114     <a class="code" href="argenta__be_8inc_8php.html#a0">$line</a>=pg_fetch_array($Res,$i);
<a name="l01115"></a>01115     $f_id=<a class="code" href="argenta__be_8inc_8php.html#a0">$line</a>['<a class="code" href="facture_8inc_8php.html#a26">f_id</a>'];
<a name="l01116"></a>01116     $f_label=<a class="code" href="argenta__be_8inc_8php.html#a0">$line</a>['f_label'];
<a name="l01117"></a>01117     <a class="code" href="balance_8php.html#a10">$a</a>[<a class="code" href="balance_8php.html#a12">$i</a>]=array($<a class="code" href="facture_8inc_8php.html#a26">f_id</a>,$f_label);
<a name="l01118"></a>01118   }
<a name="l01119"></a>01119   <span class="keywordflow">return</span> <a class="code" href="balance_8php.html#a10">$a</a>;
<a name="l01120"></a>01120 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a14"></a><!-- doxytag: member="fiche_inc.php::getFicheName" ref="a14" args="($p_cn, $p_id)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">getFicheName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_id</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
retourne le nom de la fiche en fournissant le quick_code 
<p>
getFicheName<p>
parm :<ul>
<li>p_cn connexion</li></ul>
<p>
p_id quick_code gen :<ul>
<li>none return:</li></ul>
<p>
string avec nom fiche
<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01006">1006</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, and <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>.
<p>
Referenced by <a class="el" href="user__form__ach_8php-source.html#l00457">FormAchView()</a>, and <a class="el" href="user__form__ven_8php-source.html#l00415">FormVenteView()</a>.<div class="fragment"><pre class="fragment"><a name="l01006"></a>01006                                    {
<a name="l01007"></a>01007   <span class="comment">// Retrieve the attribute with the ad_id 1</span>
<a name="l01008"></a>01008   <span class="comment">// 1 is always the name</span>
<a name="l01009"></a>01009 
<a name="l01010"></a>01010   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"select vw_name from </span>
<a name="l01011"></a>01011 <span class="stringliteral">                        vw_fiche_attr where quick_code='$p_id'"</span>);
<a name="l01012"></a>01012   <span class="keywordflow">if</span> ( pg_NumRows($Res) == 0 ) <span class="keywordflow">return</span> <span class="stringliteral">"Unknown"</span>;
<a name="l01013"></a>01013   $st=pg_fetch_array($Res,0);
<a name="l01014"></a>01014   <span class="keywordflow">return</span> $st['vw_name'];
<a name="l01015"></a>01015 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a15"></a><!-- doxytag: member="fiche_inc.php::getFicheNameById" ref="a15" args="($p_cn, $p_id)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">getFicheNameById           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_id</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
retourne le nom de la fiche en fournissant le f_id 
<p>
getFicheNameById<p>
parm :<ul>
<li>p_cn connexion</li></ul>
<p>
p_id quick_code gen :<ul>
<li>none return:</li></ul>
<p>
string avec nom fiche
<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01028">1028</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, and <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>.
<p>
Referenced by <a class="el" href="fiche__inc_8php-source.html#l00225">EncodeFiche()</a>.<div class="fragment"><pre class="fragment"><a name="l01028"></a>01028                                        {
<a name="l01029"></a>01029   <span class="comment">// Retrieve the attribute with the ad_id 1</span>
<a name="l01030"></a>01030   <span class="comment">// 1 is always the name</span>
<a name="l01031"></a>01031    <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"select av_text from</span>
<a name="l01032"></a>01032 <span class="stringliteral">                     attr_value</span>
<a name="l01033"></a>01033 <span class="stringliteral">                     natural join jnt_fic_att_value</span>
<a name="l01034"></a>01034 <span class="stringliteral">                     natural join fiche</span>
<a name="l01035"></a>01035 <span class="stringliteral">                     where</span>
<a name="l01036"></a>01036 <span class="stringliteral">                     f_id=$p_id and</span>
<a name="l01037"></a>01037 <span class="stringliteral">                     ad_id="</span>.<a class="code" href="constant_8php.html#a56">ATTR_DEF_NAME</a>);
<a name="l01038"></a>01038 
<a name="l01039"></a>01039   <span class="keywordflow">if</span> ( pg_NumRows($Res) == 0 ) <span class="keywordflow">return</span> <span class="stringliteral">"Unknown"</span>;
<a name="l01040"></a>01040   $st=pg_fetch_array($Res,0);
<a name="l01041"></a>01041   <span class="keywordflow">return</span> $st['av_text'];
<a name="l01042"></a>01042 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a5"></a><!-- doxytag: member="fiche_inc.php::GetNextFiche" ref="a5" args="($p_cn, $p_base)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">GetNextFiche           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_base</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Crée le poste suivant pour une fiche en fonction de la classe de base (fichedef(fd_class_base)). 
<p>
GetNextFiche<p>
parm :<ul>
<li>p_cn connexion</li></ul>
<p>
p_base gen :<ul>
<li>return:</li><li></li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l00480">480</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="jrn__detail_8php-source.html#l00124">$l_line</a>, <a class="el" href="setup_8php-source.html#l00404">$Max</a>, <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="impress__bilan_8php-source.html#l00032">$ret</a>, <a class="el" href="debug_8php-source.html#l00034">echo_debug()</a>, and <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>.
<p>
Referenced by <a class="el" href="fiche__inc_8php-source.html#l00038">AddFiche()</a>.<div class="fragment"><pre class="fragment"><a name="l00480"></a>00480                                      {
<a name="l00481"></a>00481   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"select max(pcm_val) as maxcode from tmp_pcmn where pcm_val_parent = $p_base"</span>);
<a name="l00482"></a>00482  <a class="code" href="setup_8php.html#a11">$Max</a>=pg_NumRows($Res);
<a name="l00483"></a>00483  <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"$Max=pg_NumRows"</span>);
<a name="l00484"></a>00484   <a class="code" href="jrn__detail_8php.html#a11">$l_line</a>=pg_fetch_array($Res,0);
<a name="l00485"></a>00485   <a class="code" href="impress__bilan_8php.html#a0">$ret</a>=<a class="code" href="jrn__detail_8php.html#a11">$l_line</a>['maxcode'];
<a name="l00486"></a>00486  <span class="keywordflow">if</span> ( $ret == <span class="stringliteral">""</span> ) {
<a name="l00487"></a>00487    <a class="code" href="impress__bilan_8php.html#a0">$ret</a>=sprintf(<span class="stringliteral">"%d%04d"</span>,$p_base,0);
<a name="l00488"></a>00488    <span class="keywordflow">return</span> <a class="code" href="impress__bilan_8php.html#a0">$ret</a>+1;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490  }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492   <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"ret $ret"</span>);
<a name="l00493"></a>00493   <span class="keywordflow">return</span> <a class="code" href="impress__bilan_8php.html#a0">$ret</a>+1;
<a name="l00494"></a>00494 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a28"></a><!-- doxytag: member="fiche_inc.php::GetParent" ref="a28" args="($p_cn, $p_val)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">GetParent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_val</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the parent in tmp_pcmn. 
<p>
GetParent<p>
parm :<ul>
<li>cn database connextion</li></ul>
<p>
the base we want insert gen :<ul>
<li>return: the parent</li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01468">1468</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="balance_8php-source.html#l00113">$a</a>, <a class="el" href="postgres_8php-source.html#l00222">CountSql()</a>, and <a class="el" href="debug_8php-source.html#l00034">echo_debug()</a>.
<p>
Referenced by <a class="el" href="fiche__inc_8php-source.html#l00548">UpdateFiche()</a>.<div class="fragment"><pre class="fragment"><a name="l01469"></a>01469 {
<a name="l01470"></a>01470   $len=strlen($p_val)-1;
<a name="l01471"></a>01471   <span class="keywordflow">for</span> ($i=$len-1;$i&gt;0;$i--) {
<a name="l01472"></a>01472     <a class="code" href="balance_8php.html#a10">$a</a>=substr($p_val,0,$i);
<a name="l01473"></a>01473     <a class="code" href="debug_8php.html#a0">echo_debug</a> (<span class="stringliteral">"parent == $a len =1"</span>);
<a name="l01474"></a>01474     <span class="keywordflow">if</span> (<a class="code" href="postgres_8php.html#a10">CountSql</a>($p_cn,<span class="stringliteral">"select pcm_val from tmp_pcmn where pcm_val=$a"</span>) == 1)
<a name="l01475"></a>01475       <span class="keywordflow">return</span> <a class="code" href="balance_8php.html#a10">$a</a>;
<a name="l01476"></a>01476   }
<a name="l01477"></a>01477 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a25"></a><!-- doxytag: member="fiche_inc.php::InsertModeleLine" ref="a25" args="($p_cn, $p_fid, $p_adid)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">InsertModeleLine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_fid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_adid</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Insert a new row into jnt_fic_attr for adding a new attribute to the card model parm :<ul>
<li>p_cn connection</li></ul>
<p>
the fiche_def.fd_id, id of the cat of the model<ul>
<li>the ad_id is the attr_def.ad_id gen :<ul>
<li>none return: none. </li></ul>
</li></ul>

<p>
InsertModeleLine
<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01361">1361</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="bank_8inc_8php-source.html#l00169">$sql</a>, and <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>.<div class="fragment"><pre class="fragment"><a name="l01362"></a>01362 {
<a name="l01363"></a>01363   <span class="comment">// Insert a new attribute for the model</span>
<a name="l01364"></a>01364   <span class="comment">// it means insert a row in jnt_fic_attr</span>
<a name="l01365"></a>01365   <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=sprintf(<span class="stringliteral">"insert into jnt_fic_attr (fd_id,ad_id) values (%d,%d)"</span>, 
<a name="l01366"></a>01366                $p_fid,$p_adid);
<a name="l01367"></a>01367   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l01368"></a>01368                        
<a name="l01369"></a>01369 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a30"></a><!-- doxytag: member="fiche_inc.php::IsFicheOfJrn" ref="a30" args="($p_cn, $p_jrn, $p_fiche, $p_type=&quot;&quot;)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">IsFicheOfJrn           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_jrn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_fiche</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_type</em> = <code>&quot;&quot;</code></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Check if a fiche is used by a jrn return 1 if the fiche is in the range otherwise 0. 
<p>
IsFicheOfJrn<p>
parm :<ul>
<li>p_cn connextion</li></ul>
<p>
j_jrn journal_id<ul>
<li>$p_type : deb or cred</li><li>$p_fiche : quick_code gen :<ul>
<li>none</li></ul>
</li></ul>
<p>
return 1 if the fiche is in the range otherwise 0
<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01532">1532</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="fiche__new_8php-source.html#l00136">$list</a>, <a class="el" href="setup_8php-source.html#l00404">$Max</a>, <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="bank_8inc_8php-source.html#l00169">$sql</a>, <a class="el" href="ac__common_8php-source.html#l00267">echo_warning()</a>, and <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>.
<p>
Referenced by <a class="el" href="user__form__fin_8php-source.html#l00042">form_verify_input()</a>.<div class="fragment"><pre class="fragment"><a name="l01533"></a>01533 {
<a name="l01534"></a>01534   $get=<span class="stringliteral">""</span>;
<a name="l01535"></a>01535   <span class="keywordflow">if</span> ( $p_type == 'deb' ) {
<a name="l01536"></a>01536     $get='jrn_def_fiche_deb';
<a name="l01537"></a>01537   }
<a name="l01538"></a>01538   <span class="keywordflow">if</span> ( $p_type == 'cred' ) {
<a name="l01539"></a>01539     $get='jrn_def_fiche_cred';
<a name="l01540"></a>01540   }
<a name="l01541"></a>01541   <span class="keywordflow">if</span> ( $get != <span class="stringliteral">""</span> ) {
<a name="l01542"></a>01542     <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"select $get as fiche from jrn_def where jrn_def_id=$p_jrn"</span>);
<a name="l01543"></a>01543   } <span class="keywordflow">else</span> {
<a name="l01544"></a>01544     <span class="comment">// Get all the fiche type (deb and cred)</span>
<a name="l01545"></a>01545     <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">" select jrn_def_fiche_cred as fiche  </span>
<a name="l01546"></a>01546 <span class="stringliteral">                         from jrn_def where jrn_def_id=$p_jrn</span>
<a name="l01547"></a>01547 <span class="stringliteral">                        union</span>
<a name="l01548"></a>01548 <span class="stringliteral">                         select jrn_def_fiche_deb </span>
<a name="l01549"></a>01549 <span class="stringliteral">                         from jrn_def where jrn_def_id=$p_jrn"</span>
<a name="l01550"></a>01550                  );
<a name="l01551"></a>01551   }
<a name="l01552"></a>01552   <a class="code" href="setup_8php.html#a11">$Max</a>=pg_NumRows($Res);
<a name="l01553"></a>01553   <span class="keywordflow">if</span> ( $Max==0) {
<a name="l01554"></a>01554     <a class="code" href="ac__common_8php.html#a11">echo_warning</a>(<span class="stringliteral">"No rows"</span>);
<a name="l01555"></a>01555     <span class="keywordflow">return</span> null;
<a name="l01556"></a>01556   }
<a name="l01557"></a>01557   <span class="comment">// Normally Max must be == 1</span>
<a name="l01558"></a>01558   <a class="code" href="fiche__new_8php.html#a7">$list</a>=pg_fetch_array($Res,0);
<a name="l01559"></a>01559   <span class="keywordflow">if</span> ( $list['<a class="code" href="classfiche.html">fiche</a>']==<span class="stringliteral">""</span>) {
<a name="l01560"></a>01560     <a class="code" href="ac__common_8php.html#a11">echo_warning</a>(<span class="stringliteral">"No fiche"</span>);
<a name="l01561"></a>01561     <span class="keywordflow">return</span> null;
<a name="l01562"></a>01562   }
<a name="l01563"></a>01563   
<a name="l01564"></a>01564  <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=<span class="stringliteral">"select *</span>
<a name="l01565"></a>01565 <span class="stringliteral">        from vw_fiche_attr</span>
<a name="l01566"></a>01566 <span class="stringliteral">        where  </span>
<a name="l01567"></a>01567 <span class="stringliteral">           fd_id in ("</span>.$list['<a class="code" href="classfiche.html">fiche</a>'].<span class="stringliteral">") and quick_code='$p_fiche'"</span>; 
<a name="l01568"></a>01568 
<a name="l01569"></a>01569   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l01570"></a>01570   <a class="code" href="setup_8php.html#a11">$Max</a>=pg_NumRows($Res);
<a name="l01571"></a>01571   <span class="keywordflow">if</span> ($Max==0 ) 
<a name="l01572"></a>01572     <span class="keywordflow">return</span> 0;
<a name="l01573"></a>01573   <span class="keywordflow">else</span>
<a name="l01574"></a>01574     <span class="keywordflow">return</span> 1;
<a name="l01575"></a>01575 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a13"></a><!-- doxytag: member="fiche_inc.php::Remove" ref="a13" args="($p_cn, $p_fid)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">Remove           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_fid</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
enleve une fiche dans attr_value, jnt_fic_att_value et fiche a la condition que ce poste n'aie jamais été utilisé parm :<ul>
<li>p_cn</li></ul>
<p>
p_fid fiche(f_id) gen :<ul>
<li>none return:</li></ul>
<p>
none 
<p>
Remove
<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l00956">956</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="postgres_8php-source.html#l00222">CountSql()</a>, <a class="el" href="ac__common_8php-source.html#l00036">echo_error()</a>, <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>, <a class="el" href="ac__common_8php-source.html#l00206">FormatString()</a>, <a class="el" href="fiche__inc_8php-source.html#l01331">GetClass()</a>, <a class="el" href="fiche__inc_8php-source.html#l01232">GetCreateAccount()</a>, <a class="el" href="fiche__inc_8php-source.html#l01300">GetFicheDef()</a>, and <a class="el" href="ac__common_8php-source.html#l00076">isNumber()</a>.<div class="fragment"><pre class="fragment"><a name="l00956"></a>00956                                 {
<a name="l00957"></a>00957   <span class="keywordflow">if</span> ( ! isset ($p_cn) ||
<a name="l00958"></a>00958        ! isset ($p_fid) ) {
<a name="l00959"></a>00959     <a class="code" href="ac__common_8php.html#a0">echo_error</a> (<span class="stringliteral">"Remove Missing Parameter p_cn = $p_cn p_fid=$p_fid"</span>);
<a name="l00960"></a>00960     <span class="keywordflow">return</span>;
<a name="l00961"></a>00961   }
<a name="l00962"></a>00962   <span class="comment">// if the card has its own account in PCMN</span>
<a name="l00963"></a>00963   <span class="comment">// Get the fiche_def.fd_id from fiche.f_id</span>
<a name="l00964"></a>00964   $fd_id=<a class="code" href="fiche__inc_8php.html#a23">GetFicheDef</a>($p_cn,$p_fid);
<a name="l00965"></a>00965   <span class="keywordflow">if</span> ( <a class="code" href="fiche__inc_8php.html#a21">GetCreateAccount</a>($p_cn,$fd_id) == 1 ) {
<a name="l00966"></a>00966     <span class="comment">// Retrieve the class </span>
<a name="l00967"></a>00967     $class=<a class="code" href="fiche__inc_8php.html#a24">GetClass</a>($p_cn,$p_fid);
<a name="l00968"></a>00968 
<a name="l00969"></a>00969     <span class="comment">// if class is not NULL and if we use it before, we can't remove it</span>
<a name="l00970"></a>00970     <span class="keywordflow">if</span> (<a class="code" href="ac__common_8php.html#a9">FormatString</a>($<span class="keyword">class</span>) != null &amp;&amp; 
<a name="l00971"></a>00971            <a class="code" href="postgres_8php.html#a10">CountSql</a>($p_cn,<span class="stringliteral">"select * from jrnx where j_poste=$class"</span>) != 0 ) {
<a name="l00972"></a>00972       echo <span class="stringliteral">"&lt;SCRIPT&gt; alert('Impossible ce poste est utilisé dans un journal'); &lt;/SCRIPT&gt;"</span>;
<a name="l00973"></a>00973       <span class="keywordflow">return</span>;
<a name="l00974"></a>00974     } <span class="keywordflow">else</span> {
<a name="l00975"></a>00975       <span class="comment">// Remove in PCMN</span>
<a name="l00976"></a>00976       <span class="keywordflow">if</span> ( trim(strlen($<span class="keyword">class</span>)) != 0 and <a class="code" href="ac__common_8php.html#a2">isNumber</a>($<span class="keyword">class</span>) == 1)
<a name="l00977"></a>00977            <a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"delete from tmp_pcmn where pcm_val="</span>.$<span class="keyword">class</span>);
<a name="l00978"></a>00978     }
<a name="l00979"></a>00979 
<a name="l00980"></a>00980   }
<a name="l00981"></a>00981   <span class="comment">// Remove from attr_value</span>
<a name="l00982"></a>00982   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"delete from attr_value </span>
<a name="l00983"></a>00983 <span class="stringliteral">                        where jft_id in (select jft_id </span>
<a name="l00984"></a>00984 <span class="stringliteral">                                          from jnt_fic_att_value </span>
<a name="l00985"></a>00985 <span class="stringliteral">                                                natural join fiche where f_id=$p_fid)"</span>);
<a name="l00986"></a>00986   <span class="comment">// Remove from jnt_fic_att_value</span>
<a name="l00987"></a>00987   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"delete from jnt_fic_att_value where f_id=$p_fid"</span>);
<a name="l00988"></a>00988   
<a name="l00989"></a>00989   <span class="comment">// Remove from fiche</span>
<a name="l00990"></a>00990   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"delete from fiche where f_id=$p_fid"</span>);
<a name="l00991"></a>00991     
<a name="l00992"></a>00992 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a26"></a><!-- doxytag: member="fiche_inc.php::SaveModeleName" ref="a26" args="($p_cn, $p_fid, $p_label)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">SaveModeleName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_fid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_label</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Update the model's name. 
<p>
SaveModeleName<p>
parm :<ul>
<li>p_cn connection</li></ul>
<p>
the fiche_def.fd_id, id of the cat of the model<ul>
<li>the label gen :<ul>
<li>none return: none</li></ul>
</li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l01382">1382</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="bank_8inc_8php-source.html#l00169">$sql</a>, and <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>.<div class="fragment"><pre class="fragment"><a name="l01383"></a>01383 {
<a name="l01384"></a>01384   <span class="comment">// Insert a new attribute for the model</span>
<a name="l01385"></a>01385   <span class="comment">// it means insert a row in jnt_fic_attr</span>
<a name="l01386"></a>01386   <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=sprintf(<span class="stringliteral">"update   fiche_def set fd_label='%s' where </span>
<a name="l01387"></a>01387 <span class="stringliteral">                  fd_id=%d"</span>, 
<a name="l01388"></a>01388                $p_label,$p_fid);
<a name="l01389"></a>01389   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l01390"></a>01390                        
<a name="l01391"></a>01391 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7"></a><!-- doxytag: member="fiche_inc.php::UpdateFiche" ref="a7" args="($p_cn, $p_array)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">UpdateFiche           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_array</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Met a jour une fiche change dans le plan comptable, fiche,et isupp. 
<p>
UpdateFiche<p>
parm :<ul>
<li>p_cn</li></ul>
<p>
p_array gen :<ul>
<li>none return:</li><li>nothing</li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l00548">548</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="balance_8php-source.html#l00113">$a</a>, <a class="el" href="pref_8inc_8php-source.html#l00139">$label</a>, <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="bank_8inc_8php-source.html#l00169">$sql</a>, <a class="el" href="postgres_8php-source.html#l00222">CountSql()</a>, <a class="el" href="debug_8php-source.html#l00034">echo_debug()</a>, <a class="el" href="ac__common_8php-source.html#l00036">echo_error()</a>, <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>, <a class="el" href="ac__common_8php-source.html#l00206">FormatString()</a>, <a class="el" href="fiche__inc_8php-source.html#l01269">GetFicheDefRef()</a>, <a class="el" href="fiche__inc_8php-source.html#l01468">GetParent()</a>, and <a class="el" href="balance_8php-source.html#l00076">label</a>.<div class="fragment"><pre class="fragment"><a name="l00548"></a>00548                                      {
<a name="l00549"></a>00549 
<a name="l00550"></a>00550   <a class="code" href="debug_8php.html#a0">echo_debug</a> ('fiche_inc.php',__LINE__,<span class="stringliteral">"UpdateFiche"</span>);
<a name="l00551"></a>00551   $tva_error=<span class="keyword">false</span>;
<a name="l00552"></a>00552   foreach ( $p_array as $key=&gt; $element) {
<a name="l00553"></a>00553     <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"UF  $key =&gt; $element"</span>);
<a name="l00554"></a>00554     ${<span class="stringliteral">"$key"</span>}=$element;
<a name="l00555"></a>00555     <span class="comment">// Get the name</span>
<a name="l00556"></a>00556     <span class="keywordflow">if</span> ( $key == <span class="stringliteral">"ad_id"</span>.<a class="code" href="constant_8php.html#a56">ATTR_DEF_NAME</a> ) {
<a name="l00557"></a>00557       <a class="code" href="pref_8inc_8php.html#a6">$label</a>=$element;
<a name="l00558"></a>00558       <span class="keywordflow">if</span> (strlen(trim($<a class="code" href="balance_8php.html#a6">label</a>))== 0  ) 
<a name="l00559"></a>00559         <span class="keywordflow">return</span>;
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561     <span class="comment">// Get the class base</span>
<a name="l00562"></a>00562     <span class="keywordflow">if</span> ( $key==<span class="stringliteral">"ad_id"</span>.<a class="code" href="constant_8php.html#a55">ATTR_DEF_ACCOUNT</a>) {
<a name="l00563"></a>00563       $class=$element;
<a name="l00564"></a>00564     }
<a name="l00565"></a>00565     <span class="comment">// Get the vat and</span>
<a name="l00566"></a>00566     <span class="comment">// test the vat rate</span>
<a name="l00567"></a>00567     <span class="keywordflow">if</span> ( $key == 'ad_id'.<a class="code" href="constant_8php.html#a59">ATTR_DEF_TVA</a> ) {
<a name="l00568"></a>00568       <span class="comment">// is a valid rate ?</span>
<a name="l00569"></a>00569       <span class="keywordflow">if</span> ( strlen(trim($element)) == 0 ) <span class="keywordflow">continue</span>;
<a name="l00570"></a>00570       <span class="keywordflow">if</span> ( <a class="code" href="postgres_8php.html#a10">CountSql</a>($p_cn,<span class="stringliteral">"select * from tva_rate where tva_id='"</span>.$element.<span class="stringliteral">"'"</span>) == 0 ) {
<a name="l00571"></a>00571         <span class="comment">// warning</span>
<a name="l00572"></a>00572         <a class="code" href="ac__common_8php.html#a0">echo_error</a>('invalid rate') ;
<a name="l00573"></a>00573         echo '&lt;script&gt;
<a name="l00574"></a>00574                 alert(<span class="stringliteral">"Attention tva invalid remis à sa valeur par défaut "</span>);
<a name="l00575"></a>00575               &lt;/script&gt;';
<a name="l00576"></a>00576         $tva_error=<span class="keyword">true</span>;
<a name="l00577"></a>00577       }
<a name="l00578"></a>00578     }
<a name="l00579"></a>00579   }
<a name="l00580"></a>00580   <span class="comment">// If each card has it own account must also update the tmp_pcm table</span>
<a name="l00581"></a>00581   <span class="comment">//</span>
<a name="l00582"></a>00582   $fd_ref=<a class="code" href="fiche__inc_8php.html#a22">GetFicheDefRef</a>($p_cn,$<a class="code" href="classfiche.html">fiche</a>);
<a name="l00583"></a>00583   <span class="comment">// Update all the others data</span>
<a name="l00584"></a>00584   <span class="keywordflow">for</span> ( $i =0 ; $i &lt; $max ; $i++) {
<a name="l00585"></a>00585     <span class="comment">// Format text</span>
<a name="l00586"></a>00586     $text=<a class="code" href="ac__common_8php.html#a9">FormatString</a>( ${<span class="stringliteral">"av_text$i"</span>});
<a name="l00587"></a>00587     <span class="comment">// Check if we don't try to update a QUICK CODE</span>
<a name="l00588"></a>00588     <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"select ad_id from jnt_fic_att_value where jft_id="</span>.${<span class="stringliteral">"jft_id$i"</span>});
<a name="l00589"></a>00589     <a class="code" href="balance_8php.html#a10">$a</a>=pg_fetch_array($Res,0);
<a name="l00590"></a>00590     <span class="keywordflow">if</span> ( $a['ad_id'] != <a class="code" href="constant_8php.html#a78">ATTR_DEF_QUICKCODE</a>) 
<a name="l00591"></a>00591       {
<a name="l00592"></a>00592         <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=sprintf(<span class="stringliteral">"update attr_value set av_text='%s' where jft_id=%d"</span>,
<a name="l00593"></a>00593                      $text,
<a name="l00594"></a>00594                      ${<span class="stringliteral">"jft_id$i"</span>});
<a name="l00595"></a>00595       }
<a name="l00596"></a>00596     <span class="keywordflow">else</span>
<a name="l00597"></a>00597       {
<a name="l00598"></a>00598         <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=sprintf(<span class="stringliteral">"select update_quick_code(%d,'%s')"</span>,
<a name="l00599"></a>00599                      ${<span class="stringliteral">"jft_id$i"</span>},
<a name="l00600"></a>00600                      $text);
<a name="l00601"></a>00601       }
<a name="l00602"></a>00602     <span class="comment">// Execute SQL</span>
<a name="l00603"></a>00603     <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l00604"></a>00604   }
<a name="l00605"></a>00605     <span class="comment">// Update tva to his default value</span>
<a name="l00606"></a>00606   <span class="keywordflow">if</span> ( $tva_error == <span class="keyword">true</span> ) { 
<a name="l00607"></a>00607     <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=<span class="stringliteral">"update attr_value set av_text=1 where jft_id = ( select jft_id from jnt_fic_att_value </span>
<a name="l00608"></a>00608 <span class="stringliteral">                    natural join fiche natural join attr_def </span>
<a name="l00609"></a>00609 <span class="stringliteral">                 where ad_id="</span>.ATTR_DEF_TVA.<span class="stringliteral">" and f_id=$fiche)"</span>;
<a name="l00610"></a>00610     <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l00611"></a>00611   } 
<a name="l00612"></a>00612 
<a name="l00613"></a>00613   <span class="comment">// Update the PCMN if needed</span>
<a name="l00614"></a>00614   <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=<span class="stringliteral">"select av_text from attr_value natural join jnt_fic_att_value</span>
<a name="l00615"></a>00615 <span class="stringliteral">        where f_id=$fiche and ad_id="</span>.ATTR_DEF_ACCOUNT;
<a name="l00616"></a>00616   <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l00617"></a>00617 
<a name="l00618"></a>00618   <span class="keywordflow">if</span> ( pg_NumRows($Res) != 0 ) {
<a name="l00619"></a>00619     <span class="comment">// it means that a account exists</span>
<a name="l00620"></a>00620     <span class="comment">// Retrieve the name and the ad_id 5</span>
<a name="l00621"></a>00621     $f=pg_fetch_array($Res,0);
<a name="l00622"></a>00622     $class_old=$f['av_text'];
<a name="l00623"></a>00623 
<a name="l00624"></a>00624     <span class="comment">// if the class changed</span>
<a name="l00625"></a>00625     <span class="keywordflow">if</span> ( $<span class="keyword">class</span> != $class_old and $<span class="keyword">class</span> != <span class="stringliteral">""</span> ) {
<a name="l00626"></a>00626       <span class="keywordflow">if</span> ( <a class="code" href="postgres_8php.html#a10">CountSql</a>($p_cn,<span class="stringliteral">"select * from jrnx where j_poste=$class"</span>) or 
<a name="l00627"></a>00627            <a class="code" href="postgres_8php.html#a10">CountSql</a>($p_cn,<span class="stringliteral">"select * from jrnx where j_poste=$class_old"</span> ))
<a name="l00628"></a>00628       {
<a name="l00629"></a>00629         <span class="comment">// No change if the account is already used </span>
<a name="l00630"></a>00630         <a class="code" href="ac__common_8php.html#a0">echo_error</a>(<span class="stringliteral">"Not possible to change the account, already used"</span>);
<a name="l00631"></a>00631       } <span class="keywordflow">else</span> {
<a name="l00632"></a>00632         <span class="keywordflow">if</span> ( <a class="code" href="postgres_8php.html#a10">CountSql</a>($p_cn,<span class="stringliteral">"select * from tmp_pcmn where pcm_val="</span>.$<span class="keyword">class</span>) ==0)
<a name="l00633"></a>00633           <span class="comment">// we have to insert </span>
<a name="l00634"></a>00634           {
<a name="l00635"></a>00635             <span class="comment">// First we must use a parent</span>
<a name="l00636"></a>00636             $parent=<a class="code" href="fiche__inc_8php.html#a28">GetParent</a>($p_cn,$<span class="keyword">class</span>);
<a name="l00637"></a>00637             <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,
<a name="l00638"></a>00638                          <span class="stringliteral">"insert into tmp_pcmn (pcm_val,pcm_lib,pcm_val_parent) </span>
<a name="l00639"></a>00639 <span class="stringliteral">                         values ($class,'$f_label',$parent)"</span>);
<a name="l00640"></a>00640           }
<a name="l00641"></a>00641       }
<a name="l00642"></a>00642         $class=$class_old;
<a name="l00643"></a>00643     } <span class="keywordflow">else</span> <span class="comment">// $class=""</span>
<a name="l00644"></a>00644       {
<a name="l00645"></a>00645 
<a name="l00646"></a>00646         <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,<span class="stringliteral">"new account "</span>);
<a name="l00647"></a>00647         $class=$class_old;
<a name="l00648"></a>00648         <span class="keywordflow">if</span> ( <a class="code" href="postgres_8php.html#a10">CountSql</a>($p_cn,<span class="stringliteral">"select * from tmp_pcmn where pcm_val="</span>.$<span class="keyword">class</span>) == 0 ) {
<a name="l00649"></a>00649           <span class="comment">// First we must use a parent</span>
<a name="l00650"></a>00650           $parent=<a class="code" href="fiche__inc_8php.html#a28">GetParent</a>($p_cn,$<span class="keyword">class</span>);
<a name="l00651"></a>00651           <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,
<a name="l00652"></a>00652                        <span class="stringliteral">"insert into tmp_pcmn (pcm_val,pcm_lib,pcm_val_parent) </span>
<a name="l00653"></a>00653 <span class="stringliteral">                         values ($class,'$f_label',$parent)"</span>);
<a name="l00654"></a>00654         }
<a name="l00655"></a>00655       }
<a name="l00656"></a>00656     
<a name="l00657"></a>00657 
<a name="l00658"></a>00658     <span class="comment">// Change the name in TMP_PCMN</span>
<a name="l00659"></a>00659     <span class="comment">// Get the new name</span>
<a name="l00660"></a>00660     $f_label=<a class="code" href="ac__common_8php.html#a9">FormatString</a>($f_label);
<a name="l00661"></a>00661     <a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"update tmp_pcmn set pcm_lib='"</span>.$f_label.<span class="stringliteral">"' where pcm_val="</span>.$<span class="keyword">class</span>);
<a name="l00662"></a>00662 
<a name="l00663"></a>00663 
<a name="l00664"></a>00664   }
<a name="l00665"></a>00665   <span class="comment">// Update of TMP_PCMN if a class base is given (ad_id=5)</span>
<a name="l00666"></a>00666 
<a name="l00667"></a>00667 
<a name="l00668"></a>00668 
<a name="l00669"></a>00669 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a11"></a><!-- doxytag: member="fiche_inc.php::UpdateModele" ref="a11" args="($p_cn, $p_fiche)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">UpdateModele           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_fiche</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Modify the model of card change some attribute (fd_label) and permit to add line. 
<p>
UpdateModele<p>
parm :<ul>
<li>p_cn connexion</li></ul>
<p>
p_fiche fichedef(f_id) gen :<ul>
<li>none return:</li><li>none</li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l00887">887</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="recherche_8php-source.html#l00066">$array</a>, <a class="el" href="fiche__inc_8php-source.html#l01408">DisplayDetailModele()</a>, <a class="el" href="debug_8php-source.html#l00034">echo_debug()</a>, <a class="el" href="ac__common_8php-source.html#l00036">echo_error()</a>, and <a class="el" href="fiche__inc_8php-source.html#l00913">GetDataModele()</a>.<div class="fragment"><pre class="fragment"><a name="l00887"></a>00887                                       {
<a name="l00888"></a>00888 
<a name="l00889"></a>00889   <a class="code" href="recherche_8php.html#a4">$array</a>=<a class="code" href="fiche__inc_8php.html#a12">GetDataModele</a>($p_cn,$p_fiche);
<a name="l00890"></a>00890   <span class="keywordflow">if</span> ($array==null) {
<a name="l00891"></a>00891     <a class="code" href="ac__common_8php.html#a0">echo_error</a> (<span class="stringliteral">"fiche_inc:UpdateModele Fiche non trouvée"</span>);
<a name="l00892"></a>00892     <span class="keywordflow">return</span>;
<a name="l00893"></a>00893   }
<a name="l00894"></a>00894   echo '&lt;H2 <span class="keyword">class</span>=<span class="stringliteral">"info"</span>&gt;'.getFicheDefName($p_cn,$p_fiche).'&lt;/H2&gt;';
<a name="l00895"></a>00895   foreach ( $array as $key=&gt;$element) <a class="code" href="debug_8php.html#a0">echo_debug</a>('fiche_inc.php',__LINE__,"$key =&gt; $element");
<a name="l00896"></a>00896   <a class="code" href="fiche__inc_8php.html#a27">DisplayDetailModele</a>($p_cn,<a class="code" href="recherche_8php.html#a4">$array</a>,$array['ligne']);
<a name="l00897"></a>00897 
<a name="l00898"></a>00898 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4"></a><!-- doxytag: member="fiche_inc.php::ViewFiche" ref="a4" args="($p_cn, $p_type)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">ViewFiche           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_type</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Montre les fiches d'une rubrique. 
<p>
ViewFiche<p>
parm :<ul>
<li>p_cn connexion</li></ul>
<p>
$p_type fiche_def.fd_id catg of card gen :<ul>
<li>none return:</li><li>none</li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l00412">412</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="commercial_8php-source.html#l00035">$_SESSION</a>, <a class="el" href="bank_8inc_8php-source.html#l00184">$bar</a>, <a class="el" href="jrn__detail_8php-source.html#l00124">$l_line</a>, <a class="el" href="setup_8php-source.html#l00404">$Max</a>, <a class="el" href="bank_8inc_8php-source.html#l00172">$offset</a>, <a class="el" href="bank_8inc_8php-source.html#l00171">$page</a>, <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="jrn__search_8php-source.html#l00150">$sql_limit</a>, <a class="el" href="jrn__search_8php-source.html#l00151">$sql_offset</a>, <a class="el" href="bank_8inc_8php-source.html#l00170">$step</a>, <a class="el" href="postgres_8php-source.html#l00222">CountSql()</a>, <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>, <a class="el" href="user__common_8php-source.html#l00858">jrn_navigation_bar()</a>, <a class="el" href="pref_8inc_8php-source.html#l00048">METHOD</a>, <a class="el" href="action_8inc_8php-source.html#l00240">name</a>, <a class="el" href="balance_8php-source.html#l00071">table</a>, and <a class="el" href="action_8inc_8php-source.html#l00241">value</a>.<div class="fragment"><pre class="fragment"><a name="l00412"></a>00412                                   {
<a name="l00413"></a>00413   require_once(<span class="stringliteral">"user_common.php"</span>);
<a name="l00414"></a>00414   echo '&lt;H2 <span class="keyword">class</span>=<span class="stringliteral">"info"</span>&gt;'.getFicheDefName($p_cn,$p_type).'&lt;/H2&gt;';
<a name="l00415"></a>00415 
<a name="l00416"></a>00416    <a class="code" href="bank_8inc_8php.html#a21">$step</a>=<a class="code" href="commercial_8php.html#a0">$_SESSION</a>['g_pagesize'];
<a name="l00417"></a>00417    <a class="code" href="jrn__search_8php.html#a16">$sql_limit</a>=<span class="stringliteral">""</span>;
<a name="l00418"></a>00418    <a class="code" href="jrn__search_8php.html#a17">$sql_offset</a>=<span class="stringliteral">""</span>;
<a name="l00419"></a>00419    <span class="keywordflow">if</span> ( $step != -1 ) {
<a name="l00420"></a>00420      <a class="code" href="bank_8inc_8php.html#a22">$page</a>=(isset($_GET['page']))?$_GET['page']:1;
<a name="l00421"></a>00421      <a class="code" href="bank_8inc_8php.html#a23">$offset</a>=(isset($_GET['offset']))?$_GET['offset']:0;
<a name="l00422"></a>00422      $max_line=<a class="code" href="postgres_8php.html#a10">CountSql</a>($p_cn,<span class="stringliteral">"select f_id,av_text  from </span>
<a name="l00423"></a>00423 <span class="stringliteral">                          fiche join jnt_fic_att_value using (f_id) </span>
<a name="l00424"></a>00424 <span class="stringliteral">                                join attr_value using (jft_id)</span>
<a name="l00425"></a>00425 <span class="stringliteral">                       where fd_id='"</span>.$p_type.<span class="stringliteral">"' and ad_id="</span>.<a class="code" href="constant_8php.html#a56">ATTR_DEF_NAME</a>.<span class="stringliteral">" order by f_id"</span>);
<a name="l00426"></a>00426      <a class="code" href="jrn__search_8php.html#a16">$sql_limit</a>=<span class="stringliteral">" limit "</span>.$step;
<a name="l00427"></a>00427      <a class="code" href="jrn__search_8php.html#a17">$sql_offset</a>=<span class="stringliteral">" offset "</span>.$offset;
<a name="l00428"></a>00428      <a class="code" href="bank_8inc_8php.html#a25">$bar</a>=<a class="code" href="user__common_8php.html#a16">jrn_navigation_bar</a>($offset,$max_line,$step,$page);
<a name="l00429"></a>00429    }
<a name="l00430"></a>00430    
<a name="l00431"></a>00431   <span class="comment">// Get all name the cards of the select category</span>
<a name="l00432"></a>00432   <span class="comment">// 1 for attr_def.ad_id is always the name</span>
<a name="l00433"></a>00433     <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,<span class="stringliteral">"select f_id,av_text,j_qcode  from </span>
<a name="l00434"></a>00434 <span class="stringliteral">                          fiche join jnt_fic_att_value using (f_id) </span>
<a name="l00435"></a>00435 <span class="stringliteral">                                join attr_value using (jft_id)</span>
<a name="l00436"></a>00436 <span class="stringliteral">                                left outer join vw_poste_qcode using(f_id)</span>
<a name="l00437"></a>00437 <span class="stringliteral">                       where fd_id='"</span>.$p_type.
<a name="l00438"></a>00438                        <span class="stringliteral">"' and ad_id="</span>.ATTR_DEF_NAME.<span class="stringliteral">" order by f_id $sql_offset $sql_limit "</span>);
<a name="l00439"></a>00439     <a class="code" href="setup_8php.html#a11">$Max</a>=pg_NumRows($Res);
<a name="l00440"></a>00440     echo <a class="code" href="bank_8inc_8php.html#a25">$bar</a>;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442     echo '&lt;<a class="code" href="balance_8php.html#a3">table</a>&gt;';
<a name="l00443"></a>00443     <span class="keywordflow">for</span> ( $i = 0; $i &lt; $Max; $i++) {
<a name="l00444"></a>00444       <a class="code" href="jrn__detail_8php.html#a11">$l_line</a>=pg_fetch_array($Res,$i);
<a name="l00445"></a>00445       <span class="keywordflow">if</span> ( $i%2 == 0) 
<a name="l00446"></a>00446         echo '&lt;TR <span class="keyword">class</span>=<span class="stringliteral">"odd"</span>&gt;';
<a name="l00447"></a>00447       <span class="keywordflow">else</span>
<a name="l00448"></a>00448         echo '&lt;TR <span class="keyword">class</span>=<span class="stringliteral">"even"</span>&gt;';
<a name="l00449"></a>00449 
<a name="l00450"></a>00450       $span_mod='&lt;TD&gt;&lt;A href=<span class="stringliteral">"fiche.php?action=detail&amp;fiche_id='.$l_line['f_id'].'"</span>&gt;'.$l_line['j_qcode'].'&lt;/A&gt;&lt;/TD&gt;';
<a name="l00451"></a>00451       $span_del='&lt;TD&gt;'.
<a name="l00452"></a>00452         '&lt;A  href=<span class="stringliteral">"fiche.php?f_fd_id='.$p_type.'&amp;action=delete&amp;fiche_id='.$l_line['f_id'].</span>
<a name="l00453"></a>00453 <span class="stringliteral">        '"</span>&gt; <span class="keyword">delete</span>&lt;/A&gt;&lt;/td&gt;';
<a name="l00454"></a>00454 
<a name="l00455"></a>00455       echo $span_del.$span_mod.'&lt;TD&gt;'.$l_line['av_text'].<span class="stringliteral">"&lt;/TD&gt;"</span>;
<a name="l00456"></a>00456       echo '&lt;/tr&gt;';
<a name="l00457"></a>00457     }
<a name="l00458"></a>00458     echo '&lt;/table&gt;';
<a name="l00459"></a>00459     echo '&lt;<a class="code" href="constant_8php.html#a7">FORM</a> <a class="code" href="pref_8inc_8php.html#a0">METHOD</a>=<span class="stringliteral">"POST"</span> <a class="code" href="classaction.html">action</a>=<span class="stringliteral">"fiche.php"</span>&gt;';
<a name="l00460"></a>00460     echo '&lt;INPUT TYPE=<span class="stringliteral">"HIDDEN"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"fiche"</span> <a class="code" href="action_8inc_8php.html#a19">value</a>=<span class="stringliteral">"'.$p_type.'"</span>&gt;';
<a name="l00461"></a>00461     echo '&lt;INPUT TYPE=<span class="stringliteral">"SUBMIT"</span> <a class="code" href="action_8inc_8php.html#a18">name</a>=<span class="stringliteral">"add"</span> Value=<span class="stringliteral">"Ajout fiche"</span>&gt;';
<a name="l00462"></a>00462     echo '&lt;/<a class="code" href="constant_8php.html#a7">FORM</a>&gt;';
<a name="l00463"></a>00463     echo $bar;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a6"></a><!-- doxytag: member="fiche_inc.php::ViewFicheDetail" ref="a6" args="($p_cn, $p_id)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">ViewFicheDetail           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_cn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>$&nbsp;</td>
          <td class="mdname" nowrap> <em>p_id</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Montre le detail d'une fiche et ajoute les lignes manquantes dans le cas où le modèle à changer. 
<p>
ViewFicheDetail<p>
parm :<ul>
<li>p_cn</li></ul>
<p>
id de la fiche fiche(f_id) gen :<ul>
<li>return:</li><li></li></ul>

<p>
Definition at line <a class="el" href="fiche__inc_8php-source.html#l00510">510</a> of file <a class="el" href="fiche__inc_8php-source.html">fiche_inc.php</a>.
<p>
References <a class="el" href="depense_8inc_8php-source.html#l00077">$Res</a>, <a class="el" href="bank_8inc_8php-source.html#l00169">$sql</a>, <a class="el" href="fiche__inc_8php-source.html#l00225">EncodeFiche()</a>, <a class="el" href="postgres_8php-source.html#l00099">ExecSql()</a>, and <a class="el" href="fiche__inc_8php-source.html#l01300">GetFicheDef()</a>.<div class="fragment"><pre class="fragment"><a name="l00510"></a>00510                                       {
<a name="l00511"></a>00511   
<a name="l00512"></a>00512   <span class="comment">// Retrieve the fiche_def.fd_id of the card</span>
<a name="l00513"></a>00513   $fd_id=<a class="code" href="fiche__inc_8php.html#a23">GetFicheDef</a>($p_cn,$p_id);
<a name="l00514"></a>00514 
<a name="l00515"></a>00515   <span class="comment">//Update the default attribute of a card if is model has changed</span>
<a name="l00516"></a>00516   <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=<span class="stringliteral">"insert into jnt_fic_att_value (f_id,ad_id) </span>
<a name="l00517"></a>00517 <span class="stringliteral">        select $p_id, ad_id </span>
<a name="l00518"></a>00518 <span class="stringliteral">              from jnt_fic_attr </span>
<a name="l00519"></a>00519 <span class="stringliteral">        where fd_id=$fd_id and </span>
<a name="l00520"></a>00520 <span class="stringliteral">        ad_id not in (select ad_id from jnt_fic_att_value where</span>
<a name="l00521"></a>00521 <span class="stringliteral">        f_id=$p_id)"</span>;
<a name="l00522"></a>00522 
<a name="l00523"></a>00523  <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l00524"></a>00524 
<a name="l00525"></a>00525  <span class="comment">// add a empty string to attr_value</span>
<a name="l00526"></a>00526  <a class="code" href="bank_8inc_8php.html#a20">$sql</a>=<span class="stringliteral">"insert into attr_value select jft_id,'' from jnt_fic_att_value</span>
<a name="l00527"></a>00527 <span class="stringliteral">         where f_id=$p_id and jft_id not in (select jft_id from attr_value natural join jnt_fic_att_value where </span>
<a name="l00528"></a>00528 <span class="stringliteral">         f_id = $p_id)"</span>; 
<a name="l00529"></a>00529  <a class="code" href="depense_8inc_8php.html#a4">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($p_cn,$sql);
<a name="l00530"></a>00530 
<a name="l00531"></a>00531   <a class="code" href="fiche__inc_8php.html#a1">EncodeFiche</a> ($p_cn,$p_id,1);
<a name="l00532"></a>00532 }
</pre></div>
<p>
    </td>
  </tr>
</table>
</BODY>
</HTML>
