<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>phpcompta: /home/dany/developpement/phpcompta-dev/phpcompta/include/class_document_modele.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">developpement</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_000001.html">phpcompta-dev</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_000002.html">phpcompta</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_000006.html">include</a></div>
<h1>class_document_modele.php</h1><a href="class__document__modele_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> *   This file is part of PhpCompta.</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *   PhpCompta is free software; you can redistribute it and/or modify</span>
<a name="l00006"></a>00006 <span class="comment"> *   it under the terms of the GNU General Public License as published by</span>
<a name="l00007"></a>00007 <span class="comment"> *   the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00008"></a>00008 <span class="comment"> *   (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> *   PhpCompta is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00013"></a>00013 <span class="comment"> *   GNU General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
<a name="l00016"></a>00016 <span class="comment"> *   along with PhpCompta; if not, write to the Free Software</span>
<a name="l00017"></a>00017 <span class="comment"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<a name="l00018"></a>00018 <span class="comment">*/</span>
<a name="l00019"></a>00019 <span class="comment">/* $Revision$ */</span>
<a name="l00020"></a>00020 <span class="comment">// Copyright Author Dany De Bontridder ddebontridder@yahoo.fr</span>
<a name="l00028"></a><a class="code" href="classDocument__modele.html">00028</a> <span class="comment"></span><span class="keyword">class </span><a class="code" href="classDocument__modele.html">Document_modele</a> {
<a name="l00029"></a><a class="code" href="classDocument__modele.html#o0">00029</a>   var <a class="code" href="classDocument__modele.html#o0">$cn</a>;              
<a name="l00030"></a><a class="code" href="classDocument__modele.html#o1">00030</a>   var <a class="code" href="classDocument__modele.html#o1">$md_id</a>;           
<a name="l00031"></a><a class="code" href="classDocument__modele.html#o2">00031</a>   var <a class="code" href="classDocument__modele.html#o2">$md_name</a>;         
<a name="l00032"></a><a class="code" href="classDocument__modele.html#o3">00032</a>   var <a class="code" href="classDocument__modele.html#o3">$md_type</a>;         
<a name="l00033"></a><a class="code" href="classDocument__modele.html#o4">00033</a>   var <a class="code" href="classDocument__modele.html#o4">$md_lob</a>;          
<a name="l00034"></a><a class="code" href="classDocument__modele.html#o5">00034</a>   var <a class="code" href="classDocument__modele.html#o5">$md_sequence</a>;     
<a name="l00035"></a><a class="code" href="classDocument__modele.html#o6">00035</a>   var <a class="code" href="classDocument__modele.html#o6">$sequence</a>;        
<a name="l00036"></a>00036   <span class="comment">//Constructor parameter = database connexion</span>
<a name="l00037"></a><a class="code" href="classDocument__modele.html#a0">00037</a>   function <a class="code" href="classDocument__modele.html#a0">Document_modele</a>($p_cn,$p_id=-1) {
<a name="l00038"></a>00038     $this-&gt;cn=$p_cn;    
<a name="l00039"></a>00039     $this-&gt;<a class="code" href="action_8inc_8php.html#a22">md_id</a>=<a class="code" href="user__update_8php.html#a1">$p_id</a>;
<a name="l00040"></a>00040   }
<a name="l00041"></a>00041   
<a name="l00049"></a><a class="code" href="classDocument__modele.html#a1">00049</a>   function <a class="code" href="classDocument__modele.html#a1">myList</a>() { 
<a name="l00050"></a>00050     <a class="code" href="depense_8inc_8php.html#a2">$sql</a>=<span class="stringliteral">"select md_id,md_name,dt_value from document_modele join document_type on(dt_id=md_type)"</span>;
<a name="l00051"></a>00051     <a class="code" href="depense_8inc_8php.html#a3">$Res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($this-&gt;cn,$sql);
<a name="l00052"></a>00052     <a class="code" href="fiche__def_8inc_8php.html#a5">$all</a>=pg_fetch_all($Res);
<a name="l00053"></a>00053     <span class="keywordflow">if</span> ( pg_NumRows($Res) == 0 ) <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
<a name="l00054"></a>00054     <a class="code" href="user__action__ach_8php.html#a2">$r</a>='&lt;p&gt;&lt;<a class="code" href="classDocument__modele.html#a5">form</a> method=<span class="stringliteral">"post"</span>&gt;';
<a name="l00055"></a>00055     <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;table&gt;"</span>;
<a name="l00056"></a>00056     <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;tr&gt; &lt;th&gt; Nom &lt;/th&gt; &lt;th&gt;Type&lt;/Th&gt;&lt;th&gt;Fichier&lt;/th&gt;&lt;th&gt; Effacer&lt;/th&gt;"</span>; 
<a name="l00057"></a>00057     <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;/tr&gt;"</span>;
<a name="l00058"></a>00058     foreach ( $all as $row) {
<a name="l00059"></a>00059       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;tr&gt;"</span>;
<a name="l00060"></a>00060       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;td&gt;"</span>;
<a name="l00061"></a>00061       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<a class="code" href="cbc__be_8inc_8php.html#a0">$row</a>['<a class="code" href="document__modele_8inc_8php.html#a2">md_name</a>'];
<a name="l00062"></a>00062       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;/td&gt;"</span>;
<a name="l00063"></a>00063       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;td&gt;"</span>;
<a name="l00064"></a>00064       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<a class="code" href="cbc__be_8inc_8php.html#a0">$row</a>['dt_value'];
<a name="l00065"></a>00065       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;/td&gt;"</span>;
<a name="l00066"></a>00066       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;td&gt;"</span>;
<a name="l00067"></a>00067       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.='&lt;A HREF=<span class="stringliteral">"show_document_modele.php?md_id='.$row['md_id'].'"</span>&gt;<a class="code" href="classDocument.html">Document</a>&lt;/a&gt;';
<a name="l00068"></a>00068       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;/td&gt;"</span>;
<a name="l00069"></a>00069       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;TD&gt;"</span>;
<a name="l00070"></a>00070       <a class="code" href="admin_8inc_8php.html#a2">$c</a>=<span class="keyword">new</span> <a class="code" href="classwidget.html">widget</a>(<span class="stringliteral">"checkbox"</span>);
<a name="l00071"></a>00071       <a class="code" href="admin_8inc_8php.html#a2">$c</a>-&gt;name=<span class="stringliteral">"dm_remove_"</span>.$row['<a class="code" href="action_8inc_8php.html#a22">md_id</a>'];
<a name="l00072"></a>00072       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<a class="code" href="admin_8inc_8php.html#a2">$c</a>-&gt;IOValue();
<a name="l00073"></a>00073       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;/td&gt;"</span>;
<a name="l00074"></a>00074       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;/tr&gt;"</span>;
<a name="l00075"></a>00075     } 
<a name="l00076"></a>00076     <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;/table&gt;"</span>;
<a name="l00077"></a>00077     
<a name="l00078"></a>00078     <span class="comment">// need hidden parameter for subaction</span>
<a name="l00079"></a>00079     <a class="code" href="action_8inc_8php.html#a15">$a</a>=<span class="keyword">new</span> <a class="code" href="classwidget.html">widget</a>(<span class="stringliteral">"hidden"</span>);
<a name="l00080"></a>00080     <a class="code" href="action_8inc_8php.html#a15">$a</a>-&gt;name=<span class="stringliteral">"sa"</span>;
<a name="l00081"></a>00081     <a class="code" href="action_8inc_8php.html#a15">$a</a>-&gt;value=<span class="stringliteral">"rm_template"</span>;
<a name="l00082"></a>00082     <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<a class="code" href="action_8inc_8php.html#a15">$a</a>-&gt;IOValue();
<a name="l00083"></a>00083     <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<a class="code" href="action_8inc_8php.html#a15">$a</a>-&gt;Submit(<span class="stringliteral">"rm_template"</span>,<span class="stringliteral">"Effacer la sélection"</span>);
<a name="l00084"></a>00084     <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;/form&gt;&lt;/p&gt;"</span>;
<a name="l00085"></a>00085     <span class="keywordflow">return</span> <a class="code" href="user__action__ach_8php.html#a2">$r</a>;
<a name="l00086"></a>00086   }
<a name="l00103"></a><a class="code" href="classDocument__modele.html#a2">00103</a>   function <a class="code" href="classDocument__modele.html#a2">Save</a>() 
<a name="l00104"></a>00104     {
<a name="l00105"></a>00105       <span class="comment">// if name is empty return immediately</span>
<a name="l00106"></a>00106       <span class="keywordflow">if</span> ( trim(strlen($this-&gt;md_name))==0) 
<a name="l00107"></a>00107         <span class="keywordflow">return</span>;
<a name="l00108"></a>00108       <span class="comment">// Start transaction</span>
<a name="l00109"></a>00109       <a class="code" href="postgres_8php.html#a14">StartSql</a>($this-&gt;cn);
<a name="l00110"></a>00110       <span class="comment">// Save data into the table invoice</span>
<a name="l00111"></a>00111       <span class="comment">// if $this-&gt;md_id == -1 it means it is a new document model</span>
<a name="l00112"></a>00112       <span class="comment">// so first we have to insert it</span>
<a name="l00113"></a>00113       <span class="comment">// the name and the type must be set before calling save</span>
<a name="l00114"></a>00114       <span class="keywordflow">if</span> ( $this-&gt;md_id == -1) 
<a name="l00115"></a>00115         {
<a name="l00116"></a>00116 
<a name="l00117"></a>00117           <span class="comment">// insert into the table document_modele</span>
<a name="l00118"></a>00118           $this-&gt;<a class="code" href="action_8inc_8php.html#a3">name</a>=<a class="code" href="ac__common_8php.html#a9">FormatString</a>($this-&gt;md_name);
<a name="l00119"></a>00119           $this-&gt;<a class="code" href="action_8inc_8php.html#a22">md_id</a>=<a class="code" href="postgres_8php.html#a13">NextSequence</a>($this-&gt;cn,'document_modele_md_id_seq');
<a name="l00120"></a>00120           <a class="code" href="depense_8inc_8php.html#a2">$sql</a>=sprintf(<span class="stringliteral">"insert into document_modele(md_id,md_name,md_type) </span>
<a name="l00121"></a>00121 <span class="stringliteral">                              values (%d,'%s',%d)"</span>,
<a name="l00122"></a>00122                              $this-&gt;md_id,$this-&gt;name,$this-&gt;md_type);
<a name="l00123"></a>00123           <a class="code" href="line__update_8php.html#a8">$Ret</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($this-&gt;cn,$sql);
<a name="l00124"></a>00124           <span class="comment">// create the sequence for this modele of document</span>
<a name="l00125"></a>00125           $this-&gt;md_sequence=<span class="stringliteral">"document_"</span>.NextSequence($this-&gt;cn,<span class="stringliteral">"document_seq"</span>);
<a name="l00126"></a>00126           <span class="comment">// if start is not equal to 0 and he's a number than the user</span>
<a name="l00127"></a>00127           <span class="comment">// request a number change</span>
<a name="l00128"></a>00128           <span class="keywordflow">if</span> ( $this-&gt;start != 0 &amp;&amp; <a class="code" href="ac__common_8php.html#a2">isNumber</a>($this-&gt;start) == 1 )
<a name="l00129"></a>00129             {
<a name="l00130"></a>00130               <a class="code" href="depense_8inc_8php.html#a2">$sql</a>=<span class="stringliteral">"alter sequence seq_doc_type_"</span>.$this-&gt;md_type.<span class="stringliteral">" start with "</span>.$this-&gt;<a class="code" href="document__modele_8inc_8php.html#a5">start</a>;
<a name="l00131"></a>00131               <a class="code" href="postgres_8php.html#a2">ExecSql</a>($this-&gt;cn,$sql);
<a name="l00132"></a>00132             }
<a name="l00133"></a>00133           
<a name="l00134"></a>00134         }
<a name="l00135"></a>00135       <span class="comment">// Save the file</span>
<a name="l00136"></a>00136       $new_name=tempnam('/tmp<span class="charliteral">','</span>document_');
<a name="l00137"></a>00137       <a class="code" href="debug_8php.html#a0">echo_debug</a>('class_document_modele.php',__LINE__,<span class="stringliteral">"new name="</span>.$new_name);
<a name="l00138"></a>00138       <span class="keywordflow">if</span> ( strlen ($_FILES['doc']['tmp_name']) != 0 ) 
<a name="l00139"></a>00139         {
<a name="l00140"></a>00140           <span class="keywordflow">if</span> (move_uploaded_file($_FILES['doc']['tmp_name'],
<a name="l00141"></a>00141                                  $new_name)) 
<a name="l00142"></a>00142             {
<a name="l00143"></a>00143                     <span class="comment">// echo "Image saved";</span>
<a name="l00144"></a>00144               $oid= pg_lo_import($this-&gt;cn,$new_name);
<a name="l00145"></a>00145               <span class="keywordflow">if</span> ( $oid == <span class="keyword">false</span> ) 
<a name="l00146"></a>00146                 {
<a name="l00147"></a>00147                   <a class="code" href="ac__common_8php.html#a0">echo_error</a>('class_document_modele.php',__LINE__,<span class="stringliteral">"cannot upload document"</span>);
<a name="l00148"></a>00148                   <a class="code" href="postgres_8php.html#a17">Rollback</a>($cn);
<a name="l00149"></a>00149                   <span class="keywordflow">return</span>;
<a name="l00150"></a>00150                 }
<a name="l00151"></a>00151               <a class="code" href="debug_8php.html#a0">echo_debug</a>('class_document_modele.php',__LINE__,<span class="stringliteral">"Loading document"</span>);
<a name="l00152"></a>00152               <span class="comment">// Remove old document</span>
<a name="l00153"></a>00153               <a class="code" href="impress__bilan_8php.html#a0">$ret</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($this-&gt;cn,<span class="stringliteral">"select md_lob from document_modele where md_id="</span>.$this-&gt;md_id);
<a name="l00154"></a>00154               <span class="keywordflow">if</span> (pg_num_rows($ret) != 0) 
<a name="l00155"></a>00155                 {
<a name="l00156"></a>00156                   <a class="code" href="user__action__ach_8php.html#a2">$r</a>=pg_fetch_array($ret,0);
<a name="l00157"></a>00157                   <a class="code" href="modify__op_8php.html#a6">$old_oid</a>=<a class="code" href="user__action__ach_8php.html#a2">$r</a>['md_lob'];
<a name="l00158"></a>00158                   <span class="keywordflow">if</span> (strlen($old_oid) != 0) 
<a name="l00159"></a>00159                     pg_lo_unlink($this-&gt;cn,$old_oid);
<a name="l00160"></a>00160                 }
<a name="l00161"></a>00161               <span class="comment">// Load new document</span>
<a name="l00162"></a>00162               var_dump($_FILES);
<a name="l00163"></a>00163               <a class="code" href="postgres_8php.html#a2">ExecSql</a>($this-&gt;cn,<span class="stringliteral">"update document_modele set md_lob="</span>.$oid.<span class="stringliteral">", md_mimetype='"</span>.$_FILES['doc']['type'].<span class="stringliteral">"' ,md_filename='"</span>.$_FILES['doc']['<a class="code" href="action_8inc_8php.html#a3">name</a>'].<span class="stringliteral">"' where md_id="</span>.$this-&gt;md_id);
<a name="l00164"></a>00164               <a class="code" href="postgres_8php.html#a16">Commit</a>($this-&gt;cn);
<a name="l00165"></a>00165             }
<a name="l00166"></a>00166           <span class="keywordflow">else</span> 
<a name="l00167"></a>00167             {
<a name="l00168"></a>00168               echo <span class="stringliteral">"&lt;H1&gt;Error&lt;/H1&gt;"</span>;
<a name="l00169"></a>00169               <a class="code" href="postgres_8php.html#a17">Rollback</a>($this-&gt;cn);
<a name="l00170"></a>00170               <a class="code" href="balance_8php.html#a0">exit</a>;
<a name="l00171"></a>00171             }
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173     }
<a name="l00178"></a><a class="code" href="classDocument__modele.html#a3">00178</a>   function <a class="code" href="classDocument__modele.html#a3">Delete</a>() 
<a name="l00179"></a>00179     {
<a name="l00180"></a>00180       <a class="code" href="postgres_8php.html#a14">StartSql</a>($this-&gt;cn);
<a name="l00181"></a>00181       <span class="comment">// first we unlink the document</span>
<a name="l00182"></a>00182       <a class="code" href="depense_8inc_8php.html#a2">$sql</a>=<span class="stringliteral">"select md_lob from document_modele where md_id="</span>.$this-&gt;md_id;
<a name="l00183"></a>00183       <a class="code" href="pref_8inc_8php.html#a1">$res</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($this-&gt;cn,$sql);
<a name="l00184"></a>00184       <a class="code" href="user__action__ach_8php.html#a2">$r</a>=pg_fetch_array($res,0);
<a name="l00185"></a>00185       <span class="comment">// if a lob is found</span>
<a name="l00186"></a>00186       <span class="keywordflow">if</span> ( strlen ($r['md_lob']) != 0 )
<a name="l00187"></a>00187         {
<a name="l00188"></a>00188           <span class="comment">// we remove it first</span>
<a name="l00189"></a>00189           pg_lo_unlink($r['md_lob']);
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191       <span class="comment">// now we can delete the row</span>
<a name="l00192"></a>00192       <a class="code" href="depense_8inc_8php.html#a2">$sql</a>=<span class="stringliteral">"delete from document_modele where md_id ="</span>.$this-&gt;md_id;
<a name="l00193"></a>00193       <a class="code" href="depense_8inc_8php.html#a2">$sql</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($this-&gt;cn,$sql);
<a name="l00194"></a>00194       <a class="code" href="postgres_8php.html#a16">Commit</a>($this-&gt;cn);
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196   
<a name="l00203"></a><a class="code" href="classDocument__modele.html#a4">00203</a>   function <a class="code" href="classDocument__modele.html#a4">Get</a>($p_id,$p_internal) 
<a name="l00204"></a>00204     {
<a name="l00205"></a>00205       <span class="comment">// retrieve info from the table invoice</span>
<a name="l00206"></a>00206       
<a name="l00207"></a>00207       <span class="comment">// retrieve the template and generate document</span>
<a name="l00208"></a>00208       <a class="code" href="postgres_8php.html#a14">StartSql</a>($this-&gt;cn);
<a name="l00209"></a>00209       <a class="code" href="impress__bilan_8php.html#a0">$ret</a>=<a class="code" href="postgres_8php.html#a2">ExecSql</a>($cn,<span class="stringliteral">"select iv_name,iv_file from invoice where iv_id"</span>.$this-&gt;iv_id);
<a name="l00210"></a>00210       <span class="keywordflow">if</span> ( pg_num_rows ($ret) == 0 )
<a name="l00211"></a>00211         <span class="keywordflow">return</span>;
<a name="l00212"></a>00212       <a class="code" href="cbc__be_8inc_8php.html#a0">$row</a>=pg_fetch_array($ret,0);
<a name="l00213"></a>00213       <span class="comment">//the template is saved into file $tmp</span>
<a name="l00214"></a>00214       <a class="code" href="show__document__modele_8php.html#a5">$tmp</a>=tempnam('/tmp/<span class="charliteral">','</span>invoice_');
<a name="l00215"></a>00215       pg_lo_export($cn,$row['iv_file'],$tmp);
<a name="l00216"></a>00216       <span class="comment">// Parse the file </span>
<a name="l00217"></a>00217       
<a name="l00218"></a>00218       
<a name="l00219"></a>00219       
<a name="l00220"></a>00220       
<a name="l00221"></a>00221       <span class="comment">// send it to stdout</span>
<a name="l00222"></a>00222       ini_set('zlib.output_compression<span class="charliteral">','</span>Off');
<a name="l00223"></a>00223       header(<span class="stringliteral">"Pragma: public"</span>);
<a name="l00224"></a>00224       header(<span class="stringliteral">"Expires: Mon, 26 Jul 1997 05:00:00 GMT"</span>);
<a name="l00225"></a>00225       header(<span class="stringliteral">"Last-Modified: "</span> . gmdate(<span class="stringliteral">"D, d M Y H:i:s"</span>) . <span class="stringliteral">" GMT"</span>);
<a name="l00226"></a>00226       header(<span class="stringliteral">"Cache-Control: must-revalidate"</span>);
<a name="l00227"></a>00227       header('Content-type: rtf/x-application');
<a name="l00228"></a>00228       header('Content-Disposition: attachment;filename=<span class="stringliteral">"invoice'.$p_internal.'.rtf"</span>',FALSE);
<a name="l00229"></a>00229       header(<span class="stringliteral">"Accept-Ranges: bytes"</span>);
<a name="l00230"></a>00230       <a class="code" href="show__document__modele_8php.html#a6">$file</a>=fopen($tmp,<span class="charliteral">'r'</span>);
<a name="l00231"></a>00231       <span class="keywordflow">while</span> ( !feof ($file) )
<a name="l00232"></a>00232         {
<a name="l00233"></a>00233           echo fread($file,8192);
<a name="l00234"></a>00234         }
<a name="l00235"></a>00235       fclose($file);
<a name="l00236"></a>00236       
<a name="l00237"></a>00237       unlink ($tmp);
<a name="l00238"></a>00238       
<a name="l00239"></a>00239       <a class="code" href="postgres_8php.html#a16">Commit</a>($cn);
<a name="l00240"></a>00240       
<a name="l00241"></a>00241     }
<a name="l00251"></a><a class="code" href="classDocument__modele.html#a5">00251</a>   function <a class="code" href="classDocument__modele.html#a5">form</a>($p_action) 
<a name="l00252"></a>00252     {
<a name="l00253"></a>00253       <a class="code" href="user__action__ach_8php.html#a2">$r</a>=<span class="stringliteral">"&lt;p&gt;"</span>;
<a name="l00254"></a>00254       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.='&lt;<a class="code" href="classDocument__modele.html#a5">form</a> enctype=<span class="stringliteral">"multipart/form-data"</span>  <a class="code" href="classaction.html">action</a>=<span class="stringliteral">"'.$p_action.'"</span> method=<span class="stringliteral">"post"</span>&gt;';
<a name="l00255"></a>00255       <a class="code" href="impress__rapport_8php.html#a3">$t</a>=<span class="keyword">new</span> <a class="code" href="classwidget.html">widget</a>(<span class="stringliteral">"text"</span>);
<a name="l00256"></a>00256       <a class="code" href="impress__rapport_8php.html#a3">$t</a>-&gt;name=<span class="stringliteral">"md_name"</span>;
<a name="l00257"></a>00257       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">" Nom "</span>.$t-&gt;IOValue().<span class="stringliteral">""</span>;
<a name="l00258"></a>00258       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"Type de document "</span>;
<a name="l00259"></a>00259       <a class="code" href="admin_8inc_8php.html#a4">$w</a>=<span class="keyword">new</span> <a class="code" href="classwidget.html">widget</a>(<span class="stringliteral">"select"</span>);
<a name="l00260"></a>00260       <a class="code" href="admin_8inc_8php.html#a4">$w</a>-&gt;name=<span class="stringliteral">"md_type"</span>;
<a name="l00261"></a>00261       <a class="code" href="admin_8inc_8php.html#a4">$w</a>-&gt;value=<a class="code" href="ac__common_8php.html#a12">make_array</a>($this-&gt;cn,'select <a class="code" href="action_8inc_8php.html#a19">dt_id</a>,dt_value from document_type');
<a name="l00262"></a>00262       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<a class="code" href="admin_8inc_8php.html#a4">$w</a>-&gt;IOValue();
<a name="l00263"></a>00263       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;/p&gt;&lt;p&gt;"</span>;
<a name="l00264"></a>00264       $f=<span class="keyword">new</span> <a class="code" href="classwidget.html">widget</a>(<span class="stringliteral">"file"</span>);
<a name="l00265"></a>00265       $f-&gt;name=<span class="stringliteral">"doc"</span>;
<a name="l00266"></a>00266       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"fichier "</span>.$f-&gt;IOValue().<span class="stringliteral">""</span>;
<a name="l00267"></a>00267       <span class="comment">// we need to add the sub action as hidden</span>
<a name="l00268"></a>00268       <a class="code" href="poste_8inc_8php.html#a8">$h</a>=<span class="keyword">new</span> <a class="code" href="classwidget.html">widget</a>(<span class="stringliteral">"hidden"</span>);
<a name="l00269"></a>00269       <a class="code" href="poste_8inc_8php.html#a8">$h</a>-&gt;name=<span class="stringliteral">"sa"</span>;
<a name="l00270"></a>00270       <a class="code" href="poste_8inc_8php.html#a8">$h</a>-&gt;value=<span class="stringliteral">"add_document"</span>;
<a name="l00271"></a>00271       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<a class="code" href="poste_8inc_8php.html#a8">$h</a>-&gt;IOValue();
<a name="l00272"></a>00272       <a class="code" href="bilan_8php.html#a2">$start</a>=<span class="keyword">new</span> <a class="code" href="classwidget.html">widget</a>(<span class="stringliteral">"text"</span>);
<a name="l00273"></a>00273       <a class="code" href="bilan_8php.html#a2">$start</a>-&gt;name=<span class="stringliteral">"start_seq"</span>;
<a name="l00274"></a>00274       <a class="code" href="bilan_8php.html#a2">$start</a>-&gt;size=9;
<a name="l00275"></a>00275       <a class="code" href="bilan_8php.html#a2">$start</a>-&gt;value=<span class="stringliteral">"0"</span>;
<a name="l00276"></a>00276       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">" Numerotation commence a "</span>.$start-&gt;IOValue().<span class="stringliteral">""</span>;
<a name="l00277"></a>00277       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<a class="code" href="admin_8inc_8php.html#a4">$w</a>-&gt;Submit('add_document<span class="charliteral">','</span>Ajout');
<a name="l00278"></a>00278       <a class="code" href="user__action__ach_8php.html#a2">$r</a>.=<span class="stringliteral">"&lt;/form&gt;&lt;/p&gt;"</span>;
<a name="l00279"></a>00279       <span class="keywordflow">return</span> <a class="code" href="user__action__ach_8php.html#a2">$r</a>;
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 }
<a name="l00283"></a>00283 ?&gt;
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri Jun 23 23:33:59 2006 for phpcompta by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.4 </small></address>
</body>
</html>
